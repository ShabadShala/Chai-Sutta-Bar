<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="apple-mobile-web-app-capable" content="yes">
        
        <meta charset="UTF-8">        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        
        
        <title>Chai Sutta Bar - Bagha Purana</title>
        <meta name="description" content="Biggest chai chain in India">    
        <meta name="robots" content="index, follow">
        <link rel="canonical" href="https://shabadshala.github.io/Chai-Sutta-Bar/">
        
        <link rel="manifest" href="manifest.json">
        <link rel="icon" type="image/x-icon" href="favicon.ico">
        
        <script type="application/ld+json">
            {
                "@context": "https://schema.org",
                "@type": "WebPage",
                "name": "Chai Sutta Bar - Bagha Purana",
                "description": "Experience the taste of chai, pizza, burger and other edibles at Bagha Purana.",
                "url": "https://shabadshala.github.io/Chai-Sutta-Bar/",
                "publisher": {
                    "@type": "Organization",
                    "name": "Shabad Shala",
                    "logo": {
                        "@type": "ImageObject",
                        "url": "https://shabadshala.github.io/Chai-Sutta-Bar/icon-512.png"
                    }
                },
                "author": {
                    "@type": "Person",
                    "name": "Shabad Shala"
                    "name": "Shabad Shala"
                },
                "image": "https://shabadshala.github.io/Chai-Sutta-Bar/icon-512.png",
                "mainEntityOfPage": "https://shabadshala.github.io/Chai-Sutta-Bar/"
            }
        </script>
        
        
        <style>
            
            /* Universal reset */
            *,
            *::before,
            *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            }                
            
            html {
            font-size: clamp(3px, 1vw, 3.5px);
            }        
            
            .noscript-warning {
            background-color: red;
            color: white;
            padding: 15px;
            font-size: 18px;
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;  /* Ensure it starts from the very left */
            right: 0; /* Ensure it fully spans to the right */
            width: 100%; /* Use full width */
            z-index: 9999;
            margin: 0; /* Remove any margins */
            box-sizing: border-box; /* Prevent padding from increasing width */
            }
            
            
            .noscript-warning button {
            background: transparent; /* Makes button clear */
            color: white;
            margin-top: 15px;
            padding: 8px 15px;
            border: 2px solid white; /* Adds a visible border */
            cursor: pointer;
            font-size: 16px;
            }
            
            .noscript-warning button:hover {
            background: rgba(255, 255, 255, 0.2); /* Adds slight transparency effect on hover */
            }
            
            
            /* /* General Styles */
            body {
            font-family: Arial, sans-serif;
            background-color: #212121; /* Black background */
            color: white; /* White text */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
            max-width: 100vw;
            padding:2rem;       
            user-select: none; /* Prevents text selection */
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* Internet Explorer/Edge */
            }
            
            .rectangle {
            width: 600px;
            height: 100vh; /* Ensure it covers the full viewport */
            position: fixed;
            top: 0; /* Align to the top */
            left: calc(50% - 300px); 
            border-left: 1px solid rgba(255, 255, 255, 0.1); /* 50% transparent */
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 9999; /* Ensure it is above all elements */
            pointer-events: none; /* Prevents blocking interactions */
            }
            
            
            
            
            
            /* Common Elements */            
            
            /* Close Button */
            #closeScrap, #closeOffer {
            position: absolute;
            top: 0;
            right: 1rem;
            font-size: 6rem;
            cursor: pointer;
            color: #333;
            }
            
            /* Scrap and offer delete button */
            .delete-btn, .offer-delete-btn {
            cursor: pointer;
            color: #cc0000;
            font-size: 4rem;
            margin-left: 2rem;
    		transition: transform 0.2s ease;
            }
            
            .delete-btn:hover, .offer-delete-btn:hover {
            transform: scale(1.2);
            color: #cc0000;
            }
            
            .qty-stepper, .offer-stepper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background-color: #f5f5f5;
            border: 1px solid red;
            border-radius: 0.5rem;
            padding: 0.5rem;
            margin-right: auto;
            }
            
            .decrement-btn, .increment-btn, .off-decrement-btn, .off-increment-btn {
            cursor: pointer;
            background: none;
            border: none;
            font-size: 5rem;
            padding: 0 1rem;
            color: #333;
            transition: background-color 0.2s ease;
            }
            
            .decrement-btn:hover, .increment-btn:hover, .off-decrement-btn:hover, .off-increment-btn:hover {
            background-color: #ddd;
            }
            
            .decrement-btn:disabled, .increment-btn:disabled,  .off-decrement-btn:disabled, .off-increment-btn:disabled {
            background-color: #ccc !important; /* Gray background */
            color: transparent !important; /* Transparent text color */
            cursor: not-allowed !important; /* Change cursor */
            opacity: 0; /* Set opacity to 0 */
            pointer-events: none; /* Disable hover effect */
            }
            
            .qty-display, .offer-qty-display {
            font-size: 4rem;
            min-width: 2rem;
            text-align: center;
            color: #333;
            }
            
            /* Button Container */
            .button-container {
            display: flex;
            justify-content: center;     
            align-items: center;
            padding-top: 1rem;    
            gap: 5rem;
            }
            
            #orderScrap, #clearScrap, .order-btn, .clear-btn {
            display: inline-block;
            padding: 2rem 3rem;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 4rem;
            cursor: pointer;            
            }
            
            #smartPickBtn2 {
            padding: 1rem 1.5rem; /* Apply padding only to this button */
            }
            
            
            
            #orderScrap, .order-btn {
            background-color: #28a745;
            }
            
            #orderScrap:hover, .order-btn:hover {
            background-color: #218838;
            transform: translateY(-2px);
            }
            
            #clearScrap, .clear-btn {
            background-color: #dc3545; /* Red */
            }
            
            #clearScrap:hover, .clear-btn:hover {
            background-color: #c82333; /* Darker red on hover */
            transform: translateY(-2px);
            }
            
            
            /* Feedback Message */
            .feedback-message {
            position: fixed;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            background: #333; /* Dark background */
            color: #fff; /* White text */
            padding: 2rem 2rem;
            border-radius: 1rem;
            font-size: 4rem;
            display: none;
            z-index: 9999;
            }           
            
            
            
            
            
            
            
            
            #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align towards top */
            z-index: 2000;
            }
            
            .loading-container {
            position: absolute;
            top: 50%; /* Set the center of spinner 40% from the top */
            transform: translateY(-50%); /* Adjust for proper centering */
            display: flex;
            flex-direction: column;
            align-items: center;
            }
            
            /* Spinner wrapper for positioning */
            .spinner-container {
            position: relative;  /* Allows absolute positioning inside */
            width: 25rem;
            height: 25rem;
            }
            
            /* Image centered inside spinner */
            .loading-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Perfect centering */
            width: 85%; /* Adjust size */
            height: auto;
            }
            
            /* Spinner animation */
            .spinner {
            border: 3.5rem solid rgba(255, 255, 255, 0.2); /* Semi-transparent white background */
            border-top: 3.5rem solid #fae68e; /* Chai color for the spinning part */
            border-radius: 50%;
            width: 100%;
            height: 100%;
            animation: spin 1.5s linear infinite;
            
            }
            
            @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
            }
            
            /* Loading message */
            .loading-message {
            margin-top: 5rem;
            font-size: 5rem;
            color: white;
            font-family: Arial, sans-serif;
            font-weight: bold;
            letter-spacing: 0.5rem;
            }
            
            
            /* Dive-in message */
            .load-container {
            top: 20px;
            position: relative;
            width: 200px;
            height: 80px; /* Adjusted for better visibility */
            text-align: center;
            overflow: hidden;
            }
            
            .loading-text {
            position: absolute;
            width: 100%;
            opacity: 0;
            animation: fadeMove 6s infinite;
            font-size: 22px;
            white-space: nowrap;
            }
            
            .loading-text:nth-child(1) {
            animation-delay: 0s;
            }
            
            .loading-text:nth-child(2) {
            animation-delay: 2s;
            }
            
            .loading-text:nth-child(3) {
            animation-delay: 4s;
            }
            
            @keyframes fadeMove {
            0% {
            opacity: 0;
            transform: translateX(40px); /* Start from right */
            }
            10% {
            opacity: 1;
            transform: translateX(0);
            }
            30% {
            opacity: 1;
            transform: translateX(0);
            }
            40% {
            opacity: 0;
            transform: translateX(-40px); /* Move to left */
            }
            100% {
            opacity: 0;
            transform: translateX(-40px);
            }
            }
            
            
            
            
            
            
            
            
            
            
            /* Image Overlay Styles */
            .image-overlay, .message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2001; /* Higher than everything else */
            backdrop-filter: blur(5px);            
            }
            
            .overlay-image {
            max-width: 90%;
            max-height: 80%;
            border-radius: 15px;
            border: 3px solid #fae68e;
            box-shadow: 0 0 30px rgba(250, 230, 142, 0.3);
            }
            
            .image-close-btn {
            position: absolute;
            top: 10%;
            left: 50%; /* Center horizontally */
            transform: translateX(-50%); /* Adjust for exact centering */
            font-size: 8rem;
            color: #fff;
            cursor: pointer;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: transform 0.3s ease;
            }
            
            .image-close-btn:hover {
            transform: scale(1.2);
            color: #ff4444;
            }           
            
            
            
            
            
            
            
            .frame {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            min-height: 100px;
            max-width: 550px;
            padding: 20px;
            border: 10px solid transparent;
            border-image: linear-gradient(to bottom, yellow, orange) 1;
            text-align: center;
            color: white;
            background: rgba(0, 0, 0, 0.6);
            box-shadow: 0 0 30px yellow;
            z-index: 2002;
            
            /* Flexbox to center content */
            display: flex;
            align-items: center;
            justify-content: center;
            }
            
            .flashMessage {
            font-size: 5rem;
            line-height: 7rem;
            
            /* Ensure text wraps properly */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            }
            
            /* Updated Close Button Positioning */
            #closeMessage {
            position: absolute;
            top: -100%; 
            left: 50%; /* Center horizontally */
            transform: translateX(-50%); /* Adjust for exact centering */
            font-size: 8rem;
            color: #fff;
            cursor: pointer;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: transform 0.3s ease;
            }
            
            #closeMessage:hover {
            transform: translateX(-50%) scale(1.2); /* Maintain centering while scaling */
            color: #ff4444;
            }
            
            
            
            
            
            
            
            
            
            
            
            /* Main Header container */
            .header {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 600px;
            position: fixed; /* Fix the header at the top */
            top: 0;
            left: 50%; /* Move the header to the center horizontally */
            transform: translateX(-50%);
            background-color: #212121; /* Match the body background */
            z-index: 100; /* Ensure the header stays above other content */
            padding: 1.5rem; /* Adjust padding as needed */
            box-shadow: 0 0.4rem 3rem rgba(0, 0, 0, 0.1); /* Adds a subtle shadow */
            /* border-bottom: 1px solid #fae68e; /* Adds a border */     */
            }
            
            .scrollable {
            position: absolute; /* Fix the header at the top */
            }
            
            /* Logo text */
            .logo-text {
            text-align: center;
            font-size: 8rem;              
            font-weight: bold;
            white-space: nowrap;
            max-width: 100%;        
            position: relative; /* Required for absolute positioning of child */
            }
            
            .logo-text .chai {
            color: #fae68e;
            }
            
            .logo-text .sutta {
            color: red;
            }
            
            .logo-text .bar {
            color: white;
            }
            
            /* Vegetarian symbol */
            .logo-text .bpa-logo {
            font-size: 3rem; /* Set font size */
            color: #F8BBD0;
            position: absolute; /* Position absolutely within .logo-text */
            top: 0; /* Align to the top */
            right: -7rem; /* Move to the right of the text */
            vertical-align: top; /* Align to the top */
            }
            
            .open-close {
            font-size: 5rem;            
            }
            
            @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0; }
            100% { opacity: 1; }
            }
            .blink {
            animation: blink 1s infinite;
            }
            
            
            
            
            
            
            
            
            
            #main-content {
            flex: 1; /* Grow to fill remaining space */
            padding-top: 16rem; /* Add padding equal to the header height */
            scroll-padding-top: 20rem;
            overflow-y: auto; /* Allow scrolling for content */
            }
            
            /* Search */
            .search-container {
            display: none;
            width: 100%;
            max-width: 600px;
            margin: 2rem auto; 
            margin-bottom: 2rem;
            position: relative; 
            /* border: 2px solid white; */
            
            border-radius: 5px;
            /* New styles to arrange children */
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            }
            
            /* When the search-container is displayed (via JS), use flex layout */
            .search-container[style*="display: block"] {
            display: flex !important;
            }
            
            /* Flex container for input and clear button */
            .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            
            width: 60%;
            }
            
            #searchInput {
            width: 100%;
            padding: 1.5rem 9rem;
            
            font-size: 6rem;
            border: 1px solid #fae68e;  /* Converted 2px to 0.125rem */
            border-radius: 0 5rem 5rem 0;              /* Increased from 3rem to 5rem for more roundness */
            background-color: #222;         /* Changed to a light background color */
            color: white;                     /* Adjusted text color for better contrast */
            outline: none;
            }
            
            #searchInput::placeholder {
            color: #888;
            font-size: 0.9em;
            }
            
            .search-clear-btn {
            position: absolute;
            right: 2.5rem;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 8rem;
            color: white;
            
            }
            
            .search-clear-btn:hover {
            color: red;
            }
            
            /* Search Lens (Magnifying Glass Icon) */
            .search-lens {
            position: absolute;            
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;   
            margin-left: 2rem;
            }
            
            
            .search-lens:hover {
            transform: translateY(-50%) translateX(5px);
            }
            
            #filterContainer {
            display: flex;           
            align-items: center; /* Aligns items vertically */
            width: 100%; /* Ensures full width */            
            font-size: 5rem;
            gap: 3rem; /* Gap between 3-button element and total-items-found */
            flex: 0 0 100%; /* Takes full width to move to next line */
            display: flex;
            justify-content: center;
            margin-top: 1rem;
            }
            
            .filter-label {
            color: #00FF00;
            }
            
            #filterButtons {
            display: flex;
            align-items: center;
            gap: 3rem; /* Gap between "Filter by" and 3-button element */
            }
            
            #threeButtonsContainer {
            display: flex;
            gap: 2rem; /* Space between buttons */
            padding: 1rem;
            position: relative; /* To position the background line */
            }
            
            #threeButtonsContainer::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 25%;
            width: 50%;
            height: 2rem; /* Adjust thickness as needed */
            background-color: #f0f0f0; /* Line color */
            z-index: -1; /* Puts it behind the buttons */
            transform: translateY(-50%); /* Centers the line */
            }
            
            .filter-btn {
            width: 10rem;
            padding: 1rem 2rem;
            color: #333;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 1rem;
            cursor: pointer;
            
            display: flex; 
            align-items: center; /* Centers vertically */
            justify-content: center; /* Centers horizontally */
            }
            
            
            .filter-btn.active {
            background-color: #3399ff; /* Lighter blue */
            color: #fff;
            border-color: #3399ff;
            }
            
            
            #total-items-found {
            color: white;
            text-align: left; /* Ensures right alignment */
            }
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            #menu {
            margin: 0 auto; /* Centers the menu */            
            width: 100%; /* Default width for small screens */
            max-width : 600px;
            transition: width 0.3s ease;
            }
            
            
            
            
            .tab-container {
            display: none;
            width: 100%;
            max-width: 600px;
            background-color: #212121;
            margin: 0 auto;
            }
            
            .tab-button {
            width: 33.33%;
            padding: 1rem;
            font-size: 16px;
            cursor: pointer;
            border: 1px solid #424242;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            color: white;
            }
            
            #allButton {
            background-color: #212121;
            }
            
            #drinksButton,
            #eatsButton {
            background-color: #2C2C2C;
            }
            
            
            
            
            .category-header {
            background-color: transparent;
            font-size: 6rem;
            font-weight: bold;
            font-family: 'Comic Sans MS';
            cursor: pointer;
            padding: 2rem 1rem; 
            display: flex;
            justify-content: space-between;
            color: #fae68e;
            align-items: center;            
            }
            
            .category-header:hover {
            transform: translateY(2px);
            }
            
            .category-header .left {
            font-weight: bold;        
            text-align: left;
            }
            
            .category-header .right {
            font-size: 5rem;
            text-align: right;
            white-space: nowrap;
            color: #40E0D0;
            }
            
            .category-items {
            padding-left: 1rem;
            padding-right: 1rem;
            padding-bottom: 0; /* Adds space after last item */
            }            
            
            .category-header.visible-border {
            border: 2px solid #F8BBD0;
            border-bottom: none;
            border-radius: 3rem 3rem 0 0;    
            }
            
            .category-items.visible-border {
            border: 2px solid #F8BBD0;
            border-top: none;
            border-radius: 0 0 3rem 3rem;
            margin-bottom: 2rem;
            }
            
            /* Menu items */
            .menu-item {
            padding: 1rem;
            border-bottom: 1px solid rgba(221, 221, 221, 0.3);            
            }
            
            .menu-item:first-child {
            border-top: 0;
            }
            
            .menu-item:last-child {
            border-bottom: none;
            margin-bottom: 1rem !important;
            }
            
            .menu-item-title {
            font-weight: bold;
            font-size: 5rem;
            }
            
            .menu-item-line {
            display: flex;
            justify-content: space-between;
            }
            
            .colAB {
            font-size: 5.5rem;
            font-weight: bold;
            }
            
            .colCDE {
            font-size: 6rem;
            font-weight: bold;
            color: #40E0D0;
            }
            
            
            
            
            
            
            
            /* Improved Menu Styling - Transit w/o changing java script */
            .category-header {
            transition: all var(--transition-speed, 0.3s) ease;
            
            /* background: linear-gradient(90deg, rgba(250,230,142,0.1) 0%, rgba(64,224,208,0.05) 100%); */
            background: linear-gradient(90deg, #212121 0%, rgba(64,224,208,0.05) 100%);
            
            
            }
            
            .category-header:hover {
            
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }
            
            .menu-item {
            transition: transform var(--transition-speed) ease;
            }
            
            .menu-item:hover {
            /* transform: translateX(1px);  increase this to shake more, default was 10px */
            } 
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            #scrapButton {
            all: unset; /* Reset all styles */
            position: fixed;
            bottom: 0;
            /* right: calc(50% - 300px + 2rem);  Align with 600px centered menu */
            right: calc(50% - 300px);
            font-size: 4rem;
            cursor: pointer; /* Pointer for better UX */
            z-index: 103;            
            /* Circular button */
            width: 13rem;
            height: 13rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #CD5C5C; /* Single solid color */
            border-radius: 50%; /* Makes it a circle */
            box-shadow: 0 0 15px #CD5C5C; /* Glow effect */
            }
            
            #scrapButton img {
            transition: opacity 0.3s ease, filter 0.3s ease;
            pointer-events: none; /* Ensure this remains */
            }            
            
            #scrapButton img.dimmed {
            opacity: 0.5;
            filter: grayscale(50%);
            }
            
            /* Green when items present */
            #scrapButton.has-items img {
            filter: invert(30%) sepia(79%) saturate(2476%) hue-rotate(86deg) brightness(118%) contrast(119%) !important;
            }
            
            @keyframes pulse-green {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
            }
            
            @media (max-width: 600px) {
            #scrapButton {
            right: 5rem; /* Default positioning for mobile */
            }
            }
            
            /* Hover effect */
            #scrapButton:hover {
            transform: scale(1.1); /* Slightly enlarge on hover */
            }
            
            #scrapButton.anti-hover:hover {
            transform: none; /* Prevents scaling */
            pointer-events: none; /* Optional: Prevents any interaction */
            }
            
            /* Active effect */
            #scrapButton:active {
            cursor: grabbing; /* Change cursor to grabbing when clicked */
            }
            
            #scrapButton .counter-badge {
            position: absolute;
            top: 1rem;
            
            color: white;
            font-weight: bold;
            font-size: 5rem;
            font-weight: bold;
            background: none;
            width: auto;
            height: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: none;
            border-radius: 0;
            }
            
            
            
            
            
            
            
            
            
            
            .scrap-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 99; /* Below scrapList's 2000 but above content */
            display: none;
            }
            
            
            
            
            
            
            /* Offers Indicator on scrap button */
            @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
            }
            
            #scrapButton::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: #00ff00;
            border-left-color: #00ff00;
            animation: rotate 5s linear infinite;
            box-shadow: 0 0 15px #00ff00,
            inset 0 0 5px #00ff00;
            opacity: 0;
            transition: opacity 0.3s ease;
            }
            
            #scrapButton.offer-has-items::before {
            opacity: 1;
            }
            
            
            
            
            
            
            
            /* Glowing effect */
            .magic-glow {
            animation: glowEffect 1s ease-in-out;
            }
            
            @keyframes glowEffect {
            0% { box-shadow: 0 0 5px #ff9800; }
            50% { box-shadow: 0 0 20px #ff9800, 0 0 40px #ff6f00; }
            100% { box-shadow: 0 0 5px #ff9800; }
            }
            
            /* Sparkle effect */
            .magic-sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #ffea00 30%, rgba(255, 255, 255, 0) 60%);
            border-radius: 50%;
            pointer-events: none;
            animation: sparkleAnim 1s ease-out forwards;
            }
            
            @keyframes sparkleAnim {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(2); }
            }
            
            
            
            
            
            
            
            
            
            
            
            
            .empty-warning {
            text-align: center;
            padding: 2rem;
            }
            
            .empty-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 10px;
            }
            
            .empty-text {
            font-size: 4rem;
            color: #555;
            margin: 5px 0;
            text-align: center;
            }
            
            
            .main-menu-link {            
            color: blue;
            text-decoration: none; /* Removes underline */
            font-weight: bold; /* Makes it stand out */
            cursor: pointer; /* Ensures it looks clickable */
            }
            
            .main-menu-link:hover {
            color: darkblue; /* Changes color on hover */
            text-decoration: none; /* Ensures underline doesn’t reappear */
            }
            
            
            .button-container-center {
            display: flex;
            justify-content: center;           
            }
            
            
            #repeatLastOrder {
            background-color: #4CAF50; /* Green color */
            }
            
            #repeatLastOrder:hover {
            background-color: #45a049;
            }
            
            
            @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 80% { transform: translateX(-5px); }
            40%, 60% { transform: translateX(5px); }
            }
            
            .repeat-animation {
            animation: shake 800ms ease-in-out;
            }
            
            
            .smart-pick-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: #ff9800;
            color: white;
            border: none;
            padding: 2rem 2rem;
            border-radius: 1rem;
            font-size: 5rem;    
            cursor: pointer;
            transition: background 0.3s;
            }
            
            .smart-pick-btn:hover {
            background-color: #e68900;
            transform: translateY(-2px);
            }
            
            
            .button-icon {
            width: 20px;
            height: 20px;
            }
            
            
            
            
            
            
            
            
            /* Warning Modal Overlay */
            .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7); /* Darker semi-transparent background */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000; /* Ensure it's on top of everything */
            backdrop-filter: blur(5px); /* Adds a blur effect to the background */
            }
            
            /* Modal Content */
            .modal-content {
            position: relative;
            background: #212121; /* Dark background to match your theme */
            color: #fae68e; /* Accent color for text */
            padding: 4rem;
            border-radius: 2rem;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); /* Subtle shadow */
            border: 2px solid #fae68e; /* Accent border */
            animation: fadeIn 0.3s ease-in-out; /* Smooth fade-in animation */
            }
            
            /* Title Styling */
            .modal-content p {
            font-size: 6rem;
            font-weight: bold;
            color: #fae68e; /* Accent color */
            margin-bottom: 3rem;
            }
            
            /* List Styling */
            .modal-content ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            }
            
            .modal-content ul li {
            font-size: 5rem;
            color: #ffffff; /* White text for better readability */
            margin: 2rem 0;
            line-height: 1.5;
            }
            
            /* Close Button */
            .close-button {
            position: absolute;
            top: 1rem;
            right: 2rem;
            font-size: 6rem;
            cursor: pointer;
            color: #fae68e; /* Accent color */
            transition: color 0.3s ease;
            }
            
            .close-button:hover {
            color: #ff4d4d; /* Red color on hover for better feedback */
            }
            
            /* Eng-Punjabi Container */
            .toggle-container {
            margin-top: 3rem;
            }
            
            .split-toggle {
            display: flex;
            width: 30rem;
            height: 8rem;
            border-radius: 5rem;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid #fae68e; /* Accent border */
            margin: 0 auto; /* Center the toggle */
            }
            
            .toggle-half {
            flex: 1;
            text-align: center;
            line-height: 8rem; /* Center text vertically */
            font-size: 4rem;
            font-weight: bold;
            transition: all 0.3s ease;
            color: #fae68e; /* Accent color */
            }
            
            .toggle-half:first-child {
            border-top-left-radius: 5rem;
            border-bottom-left-radius: 5rem;
            }
            
            .toggle-half:last-child {
            border-top-right-radius: 5rem;
            border-bottom-right-radius: 5rem;
            }
            
            .toggle-half.active {
            background: #fae68e; /* Accent background */
            color: #212121; /* Dark text for contrast */
            }
            
            .toggle-half:not(.active) {
            background: transparent;
            color: #fae68e; /* Accent color */
            }
            
            /* Fade-in Animation */
            @keyframes fadeIn {
            from {
            opacity: 0;
            transform: scale(0.9);
            }
            to {
            opacity: 1;
            transform: scale(1);
            }
            }
            
            
            
            
            
            
            
            
            
            
            
            
            /* Scrap List Modal */
            #scrapList, #offer-cart {
            display: none; /* Ensure it is hidden initially */
            position: fixed;
            top: var(--header-bottom, 8%);
            left: 50%;
            transform: translateX(-50%);
            width: 350px;
            max-width: 90vw;
            max-height: 55vh; /* Ensures modal doesn't exceed viewport */
            background: rgba(255, 255, 255, 0.95);            
            border-radius: 1rem;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            flex-direction: column;
            z-index: 100;
            }   
            
            /* Scrap Content */
            .scrap-content, .offers-content {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            max-width: 350px;
            padding: 1rem;
            border-radius: 1rem;
            color: #333;
            background: inherit;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden; /* Ensures no overflowing content */
            }
            
            #scrapItemsContainer {
            flex-grow: 1; /* Takes available space */
            overflow: hidden; /* Prevents extra scrolling outside */
            display: flex;
            flex-direction: column;
            height: calc(100% - 8rem); /* Adjust this based on totalPrice & buttons */
            }
            
            /* Scrap Items - Scrollable */
            #scrapItems {
            flex-grow: 1; /* Takes remaining space */
            overflow-y: auto; /* Enables scrolling */
            min-height: 10px; /* Ensures there's always some height */
            max-height: 100%; /* Prevents overflow issues */
            padding-right: 5px; /* Prevents scrollbar from hiding content */
            }
            
            /* Scrap Item Row */
            .scrap-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border-bottom: 1px solid #ddd;
            font-size: 4rem;
            color: #333;
            width: 100%;
            gap: 1rem;
            }
            
            /* Item Name */
            .scrap-item-name {
            flex: 3;
            overflow: hidden;
            word-wrap: break-word;
            white-space: normal;
            min-width: 100px;
            }
            
            .scrap-item-name .column-value {
            color: #005792; 
            font-weight: bold; /* Optional: Adjust font weight if needed */
            }
            
            /* Rate Container */
            .scrap-item-rate {
            flex: 2;
            text-align: right;
            padding: 0 1rem;
            min-width: 70px;
            max-width: 100px;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            }
            
            /* Updated Title Style */
            .scrap-content h2, .offers-content h2 {
            text-align: center;
            margin: 2rem 0;
            }
            
            /* Rate Text */
            .scrap-item-rate > span {
            white-space: nowrap;
            margin-left: auto;
            }            
            
            /* Total Price */
            #totalPrice {
            font-size: 2rem;
            text-align: right;
            margin: 1rem 0;
            font-weight: bold;
            flex-shrink: 0; /* Keeps it fixed */
            }
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            /* Offers Button Styles */
            #offers-button {
            position: relative;
            width: 35%; /* Ensure it doesn't exceed */
            max-width: 125px;
            margin: 0 !important; /* Remove any default margins */
            background: linear-gradient(135deg, #fae68e, #ffcc66);
            color: #212121;
            border: none;
            border-radius: 5rem 0 0 5rem;
            padding: 1rem 3rem;
            font-size: 5rem;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            display: none; /* Hidden by default */
            
            animation: float 3s ease-in-out infinite, glow 2s ease-in-out infinite alternate;
            
            }
            
            /* Floating Animation */
            @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-0.5rem); }
            100% { transform: translateY(0); }
            }
            
            /* Glow Effect */
            @keyframes glow {
            0% { box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); }
            100% { box-shadow: 0 6px 15px rgba(255, 204, 102, 0.7); }
            }
            
            /* Hover Effect */
            #offers-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 204, 102, 0.9);
            }
            
            #offers-container {
            width: 100%;
            max-width: 450px;
            margin: 1rem auto;
            display: none;
            text-align: center;
            }
            
            /* Offer Section Styles */
            .offer-container {
            margin: 2rem auto;
            max-width: 600px;
            }
            
            @media (min-width: 451px) {
            #offers-container.offer-container {            
            display: none;            
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            justify-content: center;
            max-width: 600px;
            margin: 2rem auto;
            padding: 0 1rem;
            }
            
            /* Center the last item if it's alone in the last row */
            #offers-container.offer-container > *:nth-last-child(1):nth-child(odd) {
            grid-column: span 2; /* Make it span both columns */
            justify-self: center; /* Center it within the grid */
            max-width: 400px; /* Restrict max width to 400px */
            width: 100%; /* Ensure it doesn't stretch too much */
            }
            }
            
            .offer-item {
            background: #333;
            border-radius: 3rem;
            padding: 1rem;
            margin-bottom: 2rem;
            transition: transform 0.2s ease;
            border: 2px solid #CCFFE6;
            }
            
            .offer-title {
            color: #fae68e;
            font-size: 6rem;
            margin-bottom: 1rem;
            }
            
            .offer-dates {
            color: #40E0D0;
            font-size: 5rem;
            margin-bottom: 1rem;            
            }
            
            .offer-description {
            color: #ccc;
            font-size: 4.5rem;
            line-height: 1.4;
            }
            
            .offer-item button.add-offer-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #007bff;
            color: white;
            border: none;
            padding: 0 2rem;
            
            border-radius: 1rem;
            font-size: 6rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
            }
            
            .offer-item button.add-offer-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            }
            
            
            
            
            
            
            
            
            
            
            /* Toggle Offer Cart Button */
            #toggle-cart {
            position: relative;
            
            padding: 1rem 2rem;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 2rem;
            cursor: pointer;        
            }
            
            /* Cart Header */
            .cart-header {
            font-size: 6rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 2rem;
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
            }
            
            .cart-item-header {
            flex: 3;
            overflow: hidden;
            word-wrap: break-word;
            white-space: normal;
            min-width: 100px;
            }
            
            #cart-items {
            flex: 1;
            max-height: 30rem; //offer-height
            overflow-y: auto;
            }
            
            .cart-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border-bottom: 1px solid #ddd;
            font-size: 4rem;
            color: #333;
            width: 100%;
            gap: 1rem;
            }
            
            .cart-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            }
            
            .cart-item-title {
            font-size: 4rem;
            color: #2c3e50;
            font-weight: bold;
            flex: 2;
            }
            
            .cart-item-date {
            font-size: 4rem;
            color: #2c3e50;
            margin-top: 0.5rem;
            }
            
            .cart-item-description {
            font-size: 3.5rem;
            color: #666;
            margin-top: 0.5rem;
            }        
            
            /* Empty Cart */
            .empty-cart {
            color: #888;
            font-size: 4.5rem;
            text-align: center;
            padding: 3rem 0;
            }
            
            
            
            
            
            
            
            
            /* Apply overflow and relative positioning to both containers */
            #scrapItems,
            #cart-items {
            overflow-y: auto;
            position: relative; /* Needed for pseudo-elements if adding overlays later */
            }
            
            /* WebKit browsers scrollbar styling */
            #scrapItems::-webkit-scrollbar,
            #cart-items::-webkit-scrollbar {
            width: 10px; /* Increased width for better visibility */
            }
            
            #scrapItems::-webkit-scrollbar-track,
            #cart-items::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
            }
            
            #scrapItems::-webkit-scrollbar-thumb,
            #cart-items::-webkit-scrollbar-thumb {
            background: #bbb;
            border-radius: 5px;
            }
            
            #scrapItems::-webkit-scrollbar-thumb:hover,
            #cart-items::-webkit-scrollbar-thumb:hover {
            background: #999;
            }
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            /* Main Footer Container Styling */
            .footer-container {
            display: none;
            width: 90%;
            max-width: 600px;
            margin: 3rem auto;
            margin-bottom: 1rem;
            text-align: center;
            }
            
            /* Footer Styling */
            .footer {
            background-color: rgba(16, 185, 129, 0.2);
            padding: 2rem;
            color: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            }
            
            /* Address Styling */
            .footer .address {
            font-size: 4em;
            
            
            margin-bottom: 0.5rem;
            }
            
            /* Phone Numbers */
            .footer .phone {
            font-size: 4em;
            font-weight: bold;
            }
            
            .footer .phone a {
            color: blue;
            text-decoration: none;
            font-weight: bold;
            }
            
            .footer .phone a:hover {
            text-decoration: underline;
            }
            
            #counterContainer {
            display: flex;
            justify-content: center; /* Centers them */
            align-items: center; /* Aligns vertically */
            gap: 2rem; /* Adds space between them */
            margin-top:3rem;
            }
            
            @import url('https://fonts.cdnfonts.com/css/digital-7'); /* Import Digital-7 Font */            
            
            #visitorCounter,
            #viewsCounter {
            font-family: 'Digital-7', 'Courier New', monospace; /* Digital font */
            font-size: 5rem;
            color: #fae68e;
            background-color: black;
            padding: 1rem 2rem;
            border-radius: 10px;
            display: inline-block;
            text-align: center;
            letter-spacing: 0.2rem;
            box-shadow: 0px 0px 10px rgba(0, 255, 0, 0.8); /* Glowing effect */            
            }
            
            /* Hide from main screen */
            #viewsCounter {
            display: none !important;
            }
            
            
            
            
            
            
            
            
            
            
            
            /* Communication and Social media sidebar */
            .phone-icon {
            position: absolute;
            right: 2rem; /* Adjust distance from the right */
            top: 6rem;
            transform: translateY(-50%) scaleX(-1); /* Center vertically */
            width: 5rem; /* Adjust icon size */
            height: auto;  
            
            }
            
            .phone-icon:hover {
            transform: translateY(-50%) scaleX(-1) scale(1.2); /* Slightly enlarge on hover */
            opacity: 0.8; /* Reduce opacity slightly */
            cursor: pointer;
            }
            
            /* Wrap container */
            .social {
            position: fixed; /* Ensures positioning without affecting elements */
            left: 50%;
            transform: translateX(-50%);
            max-width: 600px;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            
            }
            
            #sidebar {
            position: fixed;
            right: -100px; /* Off-screen initially */
            top: 50%;
            transform: translateY(-50%);
            width: 17rem;
            background-color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
            transition: right 0.3s ease;
            z-index: 1000;
            box-shadow: -3px 0 5px rgba(0, 0, 0, 0.5);
            pointer-events: none;
            }
            
            #sidebar a {
            margin: 2rem 0;
            text-decoration: none;
            }
            
            #sidebar .logo {
            width: 10rem;
            height: 10rem;
            transition: transform 0.3s ease; /* Smooth zoom-in effect */
            }
            
            #sidebar .logo.hovered,
            #sidebar .logo:hover {
            transform: scale(1.3); /* Zoom-in effect when hovering */
            }
            
            
            #sidebar.open {
            right: 0; /* Show sidebar when open */
            pointer-events: auto;
            }
            
            
            
            
            
            
            
            
            button.active {
            background-color: red !important; /* Change color when active */
            }
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            .starry-background {
            position: fixed;
            width: 100%;
            height: 100%;
            background: black; /* Remove this if transparent */
            z-index: -1;
            }
            
            .stars, .stars2, .stars3 {
            position: absolute;
            width: 100%;
            height: 100%;
            background: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/1231630/stars.png');
            animation: move-stars 50s linear infinite;
            }
            
            .stars2 {
            background-size: 200%;
            animation-duration: 100s;
            }
            
            .stars3 {
            background-size: 300%;
            animation-duration: 150s;
            }
            
            @keyframes move-stars {
            from { transform: translateY(0); }
            to { transform: translateY(-100%); }
            }
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            /* Welcome Modal Styles */
            .welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.5s ease-out;
            }
            
            .welcome-modal {
            background: linear-gradient(135deg, #fae68e 0%, #ffd700 100%);
            border-radius: 20px;
            padding: 3rem;
            max-width: 90%;
            width: 600px;
            position: relative;
            box-shadow: 0 0 40px rgba(250, 230, 142, 0.3);
            }
            
            .welcome-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            }
            
            .welcome-header h1 {
            font-size: 6rem;
            color: #2d2d2d;
            margin-bottom: 1.5rem;
            font-family: 'Arial Rounded MT Bold', sans-serif;
            }
            
            .welcome-body {
            background: rgba(255, 255, 255, 0.9);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            }
            
            .welcome-text {
            font-size: 5rem;
            color: #444;
            text-align: center;
            line-height: 1.4;
            margin-bottom: 2rem;
            }
            
            .welcome-features {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            }
            
            .feature-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            }
            
            .feature-icon {
            width: 4rem;
            height: 4rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
            }
            
            .feature-item span {
            font-size: 4rem;
            color: #333;
            flex: 1;
            }
            
            .welcome-close-btn {
            width: 100%;
            padding: 1.5rem;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            }
            
            .welcome-close-btn:hover {
            background: #218838;
            transform: translateY(-2px);
            }
            
            /* Confetti Animation */
            .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffd700;
            animation: confettiFall 3s linear infinite;
            }
            
            @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
            }
            
            .confetti:nth-child(1) { left: 10%; animation-delay: 0s; }
            .confetti:nth-child(2) { left: 50%; animation-delay: 0.5s; }
            .confetti:nth-child(3) { right: 10%; animation-delay: 1s; }  
            
            
            
            
            
            
        </style>
        <link rel="stylesheet" href="ham.css">
    </head>
    <body>
        <div class="rectangle"></div>
        
        <!-- This message will ONLY show if JavaScript is disabled -->
        <noscript>
            <div class="noscript-warning">
                <p>JavaScript is disabled in your browser. Please enable it to open the web-app.</p>
                <form>
                    <button type="submit">Retry</button>
                </form>
            </div>
        </noscript>
        
        
        
        
        <!-- Add this HTML just before the closing </body> tag -->
        <div id="welcomeOverlay" class="welcome-overlay" style="display: none;">
            <div class="welcome-modal">
                <div class="welcome-content">
                    <div class="welcome-header">
                        <div class="welcome-animation">
                            <div class="confetti"></div>
                            <div class="confetti"></div>
                            <div class="confetti"></div>
                        </div>
                        <h1>Welcome to Chai Sutta Bar (Bagha Purana)</h1>
                    </div>
                    <div class="welcome-body">
                        <p class="welcome-text">
                            Experience the perfect blend of tradition and taste.<br>
                            We're thrilled to have you join our chai family!
                        </p>
                        <div class="welcome-features">
                            <div class="feature-item">
                                <img src="icons/tea.svg" alt="Chai" class="feature-icon">
                                <span>Discover our authentic blends</span>
                            </div>
                            <div class="feature-item">
                                <img src="icons/snack.svg" alt="Snacks" class="feature-icon">
                                <span>Explore delicious accompaniments</span>
                            </div>
                            <div class="feature-item">
                                <img src="icons/offer.svg" alt="Offers" class="feature-icon">
                                <span>Enjoy exclusive member benefits</span>
                            </div>
                        </div>
                    </div>
                    <button id="closeWelcome" class="welcome-close-btn">
                        Let's Brew Some Magic! ☕
                    </button>
                </div>
            </div>
        </div>
        
        
        
        
        <!-- Loading Overlay -->
        <div id="loadingOverlay">
            <div class="loading-container">
                <div class="spinner-container">
                    <div class="spinner"></div>
                    <img src="veg.png" alt="Loading" class="loading-image">
                </div>
                <!--  <div class="loading-message">Loading</div> -->                
                <div class="load-container">
                    <div class="loading-text">Dine in</div>
                    <div class="loading-text">Takeaway</div>
                    <div class="loading-text">Delivery</div>
                </div>
            </div>
        </div>
        
        <!-- Flash Image Overlay -->
        <div id="imageOverlay" class="image-overlay">
            <span id="closeImage" class="image-close-btn">×</span>                    
            <img id="driveImage" 
            alt="Special Offer" 
            class="overlay-image">
        </div>
        
        <!-- Flash Message Overlay -->
        <div id="messageOverlay" class="message-overlay" style="display: none;">
            <div class="frame">
                <div id="messageText" class="flashMessage"></div>
                <span id="closeMessage" class="image-close-btn">×</span>
            </div>
        </div>  
        
        
        <!-- Header -->
        <div class="header">           
            <div class="logo-text">
                <span class="chai">CHAI</span>
                <span class="sutta">SUTTA</span>
                <span class="bar">BAR</span>                
                <div class="open-close"></div>               
            </div>            
            <img src="icons/phone.svg" class="phone-icon" alt="Phone">
        </div>
        
        
        <!-- Main Content Wrapper -->
        <div id="main-content">    
            
            <!-- Search Bar -->
            <div class="search-container">                
                <div class="search-input-wrapper">
                    <span>
                        <img src="icons/lens.svg" alt="Word Search" class="search-lens invert-icon">
                    </span>                    
                    <input type="text" id="searchInput" name="searchInput" maxlength="10" placeholder="item or rate" autocomplete="on">
                    <span id="clearButton" class="search-clear-btn" style="display: none;">×</span>
                </div>
                
                <!-- Offers -->
                <button id="offers-button"></button>
                
                <!-- Filter Container -->
                <div id="filterContainer">
                    <div id="filterButtons" style="display: none;">
                        <div class="filter-label">Filter by</div>
                        <div id="threeButtonsContainer">
                            
                            <button class="filter-btn active" data-filter="=">
                                <img src="icons/equal.svg" alt="=" width="auto" height="12">
                            </button>
                            <button class="filter-btn" data-filter="&lt;=">
                                <img src="icons/less-than-equal.svg" alt="≤" width="auto" height="12">
                            </button>
                            <button class="filter-btn" data-filter="&gt;=">
                                <img src="icons/greater-than-equal.svg" alt="≥" width="auto" height="12">
                            </button>
                            
                        </div>
                    </div>
                    <div id="total-items-found"></div>
                </div>
                
            </div>     
            
            <!-- To show offers -->
            <div id="offers-container" class="offer-container"></div>
            <button id="toggle-cart">Offer Cart (0)</button>
            
            <!-- Static Tabs -->
            <div class="tab-container">
                <button id="allButton" class="tab-button">All</button>
                <button id="drinksButton" class="tab-button">Drinks</button>
                <button id="eatsButton" class="tab-button">Dishes</button>
            </div>
            
            
            <!-- Scrap Button -->
            <div id="menu">
                <button id="scrapButton">
                    <img src="icons/food.svg" class="invert-icon" alt="Edit Icon" width="40" height="40">
                    <div class="counter-badge"></div>
                </button>
            </div>
            
        </div>
        
        
        <!-- Footer Container -->
        <div class="footer-container">
            <!-- Footer -->
            <div class="footer">
                <div class="address">Opp. Petrol Pump, Kotkapura Road</div>
                <div class="address">Bagha Purana (Moga), Punjab</div>
                <!-- <div class="phone">
                    <a href="tel:+919112400010">91124-00010</a> &nbsp; 📞 &nbsp;
                    <a href="tel:+919023406002">90234-06002</a>
                </div> -->
            </div>
            
            <!-- Counter Section -->
            <div id="counterContainer">
                <div id="visitorCounter">👤 <span>0000</span> Users</div>
                <div id="viewsCounter">👁 <span>0000</span> Views</div>
            </div>
        </div>
        
        
        
        <!-- Scrap List -->
        <div class="scrap-overlay"></div>
        <div id="scrapList">
            <div class="scrap-content">                
                <div id="closeScrap">×</div>
                <h2 style="font-size: 6rem;">Selected Items</h2>
                <div id="scrapItemsContainer">
                    <div id="scrapItems"></div>
                    <!-- Total price aligned below the rate column -->
                    <div id="totalPrice" style="font-size: 4rem; text-align: right; margin: 2rem 0; font-weight: bold;">Total: ₹0</div>
                </div>
                <div class="button-container">
                    <button id="orderScrap" class="child-lock-restricted">Order</button>
                    <button id="smartPickBtn2" class="smart-pick-btn"  title="Smart Pick"> <img src="icons/magic.svg" alt="Magic" class="button-icon"> </button>
                    <button id="clearScrap">Clear</button>
                </div>      
                <!-- Inside the #scrapList .scrap-content div, after existing button-container -->
                
            </div>
        </div> 
        
        <div id="offer-cart" style="display: none;">
            <div class="offers-content">                        
                <div id="closeOffer">×</div>
                <h2 style="font-size: 6rem;">Selected Offers</h2>
                <div id="cart-items"></div>
                <div id="totalOffers" style="font-size: 4rem; text-align: right; margin: 2rem 0; font-weight: bold;">Total Offers: 0</div>
                <div class="button-container">
                <button id="order-offers" class="order-btn child-lock-restricted">Order</button>
                <button id="clear-offers" class="clear-btn">Clear</button>
            </div>
        </div>
    </div>
    
    
    <!-- Social Container -->
    <div class="social">
        <div id="sidebar">
            <a id="delivery-link" href="#" target="_blank"><img src="sidebar/delivery.png" alt="Delivery number" class="logo"></a>
            <a id="whatsapp-link" href="#" target="_blank"><img src="sidebar/whatsapp.png" alt="Chat on WA" class="logo"></a>
            <a id="phone-link" href="#" target="_blank"><img src="sidebar/phone.png" alt="Phone" class="logo"></a>
            <a href="https://maps.app.goo.gl/AhjPPKMp7NJvBphDA" target="_blank"><img src="sidebar/location.png" alt="Location" class="logo"></a>
            <a href="https://www.facebook.com/p/Chai-Sutta-Bar-open-close-61553478237898/" target="_blank"><img src="sidebar/facebook.png" alt="Facebook" class="logo"></a>
            <a href="https://www.instagram.com/chaisuttabar_baghapurana/?hl=en" target="_blank"><img src="sidebar/insta.png" alt="Instagram" class="logo"></a>
        </div>
    </div>
    
    <div class="feedback-message"></div>
    
    <div class="starry-background">
        <div class="stars"></div>
        <div class="stars2"></div>
        <div class="stars3"></div>
    </div>
    
    
    
    <!-- Development Button -->
    <button id="devFill" style="position: fixed; bottom: 15px; left: 17px; z-index: 9999; padding: 1rem; background: #ff4444; color: white; border: none; border-radius: 5px;">
        DEV
    </button>
    
    
    
    
    
    
    
    
    <div id="counters-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3 style="color: white;">CSB-BPA Dashboard</h3>
            
            <div class="counter-grid">
                <!-- Inside the counters-modal content (search for existing counters) -->
                <div class="counter-item">
                    <img src="icons/likes.svg" alt="Likes" class="counter-icon">
                    <span id="modal-likeCounter">0000</span>
                    <span class="counter-label">Likes</span>
                </div>
                <div class="counter-item">
                    <img src="icons/download.svg" alt="Installs" class="counter-icon">
                    <span id="modal-installsCounter">0000</span>
                    <!--        <div class="counter-label">Installs</div> -->
                    <span class="counter-label">Installs</span> <!-- Changed from div to span -->
                </div>                    
                <div class="counter-item">
                    <img src="icons/users.svg" alt="Users" class="counter-icon">
                    <span id="modal-visitorCounter">0000</span>
                    <span class="counter-label">Users</span>
                </div>
                <div class="counter-item">
                    <img src="icons/eye.svg" alt="Views" class="counter-icon">
                    <span id="modal-viewsCounter">0000</span>
                    <span class="counter-label">Views</span>
                </div>
                <div class="counter-item">
                    <img src="icons/orders.svg" alt="Orders" class="counter-icon">
                    <span id="modal-orderNumber">0000</span>
                    <span class="counter-label">Orders</span>
                </div>                    
            </div>
            
            <div class="app-info" id="app-features">
                <img src="icons/feature.svg" alt="Features Icon" class="menu-icon invert-icon">
                App Features                    
                <img src="icons/feature.svg" alt="Features Icon" class="menu-icon invert-icon">
            </div>  
            
            <!--   <h3 style="color: white; font-size: 4rem;">- Misrosoft Counters -</h3> -->
        </div>
    </div>
    
    <script>
        
        
        
        
        
        
        
        
        
        
        // Welcome once per browser/install
        document.addEventListener('DOMContentLoaded', async function() {
            if (!(await hasSeenWelcomeMessage())) {
                const welcomeOverlay = document.getElementById('welcomeOverlay');
                
                setTimeout(() => {
                    welcomeOverlay.style.display = 'flex';
                    setWelcomeMessageSeen(); // Store in IndexedDB
                }, 1000);
                
                document.getElementById('closeWelcome').addEventListener('click', () => {
                    welcomeOverlay.style.display = 'none';
                });
                
                welcomeOverlay.addEventListener('click', (e) => {
                    if (e.target === welcomeOverlay) {
                        welcomeOverlay.style.display = 'none';
                    }
                });
            }
        });
        
        // ✅ Functions to handle IndexedDB storage
        const DB_NAME = "PWASettings";
        const STORE_NAME = "WelcomeFlag";
        
        function openDB() {
            return new Promise((resolve, reject) => {
                let request = indexedDB.open(DB_NAME, 1);
                request.onupgradeneeded = (event) => {
                    let db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        db.createObjectStore(STORE_NAME);
                    }
                };
                request.onsuccess = (event) => resolve(event.target.result);
                request.onerror = (event) => reject("IndexedDB error: " + event.target.error);
            });
        }
        
        async function hasSeenWelcomeMessage() {
            let db = await openDB();
            return new Promise((resolve) => {
                let tx = db.transaction(STORE_NAME, "readonly");
                let store = tx.objectStore(STORE_NAME);
                let request = store.get("welcomeMessage");
                request.onsuccess = () => resolve(request.result === true);
                request.onerror = () => resolve(false);
            });
        }
        
        async function setWelcomeMessageSeen() {
            let db = await openDB();
            let tx = db.transaction(STORE_NAME, "readwrite");
            let store = tx.objectStore(STORE_NAME);
            store.put(true, "welcomeMessage");
        }
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        // ✅ Set "All" as default active tab on page load
        document.addEventListener("DOMContentLoaded", function () {
            setActiveTab("allButton");
        });
        
        // ✅ Event Listeners for Tab Clicks
        document.getElementById("allButton").addEventListener("click", function () {
            resetFilters();
            setActiveTab("allButton");
        });
        
        document.getElementById("drinksButton").addEventListener("click", function () {
            resetFilters();
            setActiveTab("drinksButton");
            filterCategories("drinks");
        });
        
        document.getElementById("eatsButton").addEventListener("click", function () {
            resetFilters();
            setActiveTab("eatsButton");
            filterCategories("eats");
        });
        
        // ✅ Function to Set Active Tab
        function setActiveTab(activeId) {
            let tabs = ["allButton", "drinksButton", "eatsButton"];
            
            tabs.forEach(id => {
                let button = document.getElementById(id);
                if (id === activeId) {
                    button.style.backgroundColor = "#212121"; // ✅ Matches background
                    button.style.color = "white"; // ✅ Keep text visible
                    button.style.fontWeight = "bold"; // ✅ Highlight active tab
                    button.style.opacity = "1"; // ✅ Fully visible active tab
                    button.style.borderBottom = "1px solid white";  // White border at the bottom
                    } else {
                    button.style.backgroundColor = "#2C2C2C"; // ✅ Inactive tab color
                    button.style.color = "#BBBBBB"; // ✅ Slightly dim text
                    button.style.fontWeight = "normal";
                    button.style.opacity = "0.8"; // ✅ Slightly dim inactive tabs
                    button.style.borderBottom = "none";  // White border at the bottom
                }
            });
        }
        
        // ✅ Function to Filter Categories Based on Column F
        function filterCategories(filterType) {
            document.querySelectorAll('.category-header').forEach(header => {
                let columnFValue = header.dataset.columnF ? header.dataset.columnF.toLowerCase() : '';
                
                // ✅ Only show matching categories
                header.style.display = columnFValue.includes(filterType) ? "flex" : "none";
            });
            
            // ✅ Keep category items collapsed when filtering
            document.querySelectorAll('.category-items').forEach(item => {
                item.style.display = "none";
            });
        }
        
        // ✅ Function to Reset All Filters (Show Everything)
        function resetFilters() {
            document.querySelectorAll('.category-header').forEach(header => {
                header.style.display = "flex"; // Show all categories
                header.style.fontSize = "7rem"; // Reset collapsed size
                header.classList.remove("visible-border"); // Remove borders
                let rightPart = header.querySelector('.right');
                if (rightPart) rightPart.style.display = "none"; // Hide right part
            });
            
            document.querySelectorAll('.category-items').forEach(item => {
                item.style.display = "none"; // Collapse all items
                item.classList.remove("visible-border"); // Remove borders
            });
        }
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        // temp disable offer cart button
        document.getElementById("toggle-cart").style.display = "none"; // Hide
        
        // google script URL
        const scriptUrl = "https://script.google.com/macros/s/AKfycbwL-df0wEbrbZoebYhWuYZASWBkzHvMgrjQDg6AUrV4oHZTAd1y3lbyEDolErve_blZAg/exec";
        
        //Disable context menu, cut-copy-paste
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.addEventListener('copy', event => event.preventDefault());
        document.addEventListener('cut', event => event.preventDefault());
        document.addEventListener('paste', event => event.preventDefault());
        
        // Declarations
        let cachedOrderNumber = null;                    
        
        
        function showFeedback(message) {
            const feedback = document.querySelector('.feedback-message');
            feedback.textContent = message;
            feedback.style.display = 'block';
            setTimeout(() => {
                feedback.style.display = 'none';
            }, 1000);
        }
        
        
        function updateScreenSize() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            
            const header = document.querySelector('.header');
            
            // If width is greater than or equal to height, make header scrollable
            if (width >= height) {
                header.classList.add('scrollable'); // Make header scrollable
                } else {
                header.classList.remove('scrollable'); // Keep header fixed
            }
        }                    
        // Listen for window resizing
        window.addEventListener('resize', updateScreenSize);                    
        // Call the function initially to set the correct behavior based on current screen size
        updateScreenSize();
        
        
        
        async function loadReplacements() {
            try {
                const response = await fetch(`${scriptUrl}?sheet=replace`);
                const data = await response.json();
                
                SEARCH_REPLACEMENTS = data.slice(1).reduce((acc, row) => {
                    if (row.length >= 2) {
                        // Split column A by commas and process each word separately
                        const words = String(row[0]).split(',').map(word => word.trim()).filter(word => word);
                        
                        const isGurmukhi = words.some(word => /[\u0A00-\u0A7F]/.test(word));
                        
                        const replacements = isGurmukhi
                        ? String(row[1]).trim()  // Preserve exact Gurmukhi
                        : String(row[1]).toLowerCase().trim();
                        
                        words.forEach(original => {
                            if (original && replacements) {
                                acc[isGurmukhi ? original : original.toLowerCase()] = replacements;
                            }
                        });
                    }
                    return acc;
                }, {});
                
                
                console.log('Final replacements:', SEARCH_REPLACEMENTS);
                
                } catch (error) {
                console.error('Error:', error);
                SEARCH_REPLACEMENTS = {
                    'cofee': 'coffee',
                    'coofe': 'coffee',
                };
            }
        }                    
        // Initialize when page loads
        loadReplacements();
        
        
        // Filter menu items
        let selectedFilter = "="; // Default to "="                                        
        function filterMenuItems(searchQuery) {
            const menuDiv = document.getElementById('menu');
            if (!menuDiv) return;
            
            
            const menuItems = document.querySelectorAll('.menu-item');
            const categoryHeaders = document.querySelectorAll('.category-header');
            const categoryItems = document.querySelectorAll('.category-items');
            
            let totalVisibleItems = 0;
            
            
            const normalizedSearchQuery = searchQuery.trim().toLowerCase();
            const isNumberSearch = /^\d+$/.test(normalizedSearchQuery); // Check if the search query is a number                        
            
            // Show/hide filter buttons based on whether the search query is a number
            const filterButtons = document.getElementById('filterButtons');
            if (isNumberSearch) {
                filterButtons.style.display = 'flex'; // Show filter buttons
                } else {
                filterButtons.style.display = 'none'; // Hide filter buttons
            }
            
            // Get the selected filter type (=, <=, >=)
            // Use the globally selected filter type
            const filterType = selectedFilter;
            
            
            // Convert the search query to a number
            const searchNumber = isNumberSearch ? parseInt(normalizedSearchQuery, 10) : null;
            
            categoryHeaders.forEach((header, index) => {
                const categoryItem = categoryItems[index];
                const itemsInCategory = categoryItem.querySelectorAll('.menu-item');
                
                // Access the header's left and right parts (columns)
                const leftPart = header.querySelector('.left')?.textContent.trim().toLowerCase() || '';
                const rightPart = header.querySelector('.right')?.textContent.trim().toLowerCase() || '';
                
                // Combine the header text for searching
                const headerText = `${leftPart} ${rightPart}`.trim();
                
                // Debug: Log the header text and split words
                console.log("Header Text:", headerText);
                console.log("Header Words:", headerText.split(/[\s,]+/).filter(word => word.length > 0));
                
                // Check if the header matches the search query
                const isNumeric = !isNaN(normalizedSearchQuery); // Check if the search query is numeric
                
                const headerMatches = !isNumeric && headerText.split(' ').some(word => {
                    const splitWords = word.split('('); 
                    return splitWords.some(part => part.startsWith(normalizedSearchQuery));
                });
                
                
                let hasVisibleItemsInCategory = false;
                
                itemsInCategory.forEach(item => {
                    const colABElement = item.querySelector('.colAB');
                    const colCDEElement = item.querySelector('.colCDE');
                    const itemTextAB = colABElement ? colABElement.textContent.trim().toLowerCase() : '';
                    const itemTextCDE = colCDEElement ? colCDEElement.textContent.trim().toLowerCase() : '';
                    
                    let itemMatches = itemTextAB.includes('ml') || itemTextCDE.includes('ml') ? false : false;
                    
                    if (isNumberSearch) {
                        // Extract numbers from the last three columns (colCDE)
                        const numbersInCDE = itemTextCDE.match(/\d+/g) || [];
                        itemMatches = numbersInCDE.some(numberStr => {
                            const number = parseInt(numberStr, 10);
                            switch (filterType) {
                                case '=':
                                return number === searchNumber;
                                case '<=':
                                return number <= searchNumber;
                                case '>=':
                                return number >= searchNumber;
                                default:
                                return false;
                            }
                            
                        });                      
                        } else {
                        // Otherwise, check start-with words from all 5 columns (A, B, C, D, E)
                        itemMatches = itemTextAB.split(' ').some(word => {
                            const splitWords = word.split('('); 
                            return splitWords.some(part => part.startsWith(normalizedSearchQuery));
                            }) || itemTextCDE.split(' ').some(word => {
                            const splitWords = word.split('('); 
                            return splitWords.some(part => part.startsWith(normalizedSearchQuery));
                        });
                    }
                    
                    if (headerMatches || itemMatches) {
                        totalVisibleItems++;                                    
                        item.style.display = 'block';
                        hasVisibleItemsInCategory = true;
                        hasVisibleItems = true;
                        item.style.borderBottom = ''; // Reset border-bottom for all items
                        
                        } else {
                        item.style.display = 'none';
                    }
                });
                
                // Adjust the header display and styling based on matches
                if (headerMatches || hasVisibleItemsInCategory) {
                    header.style.display = 'flex';
                    categoryItem.style.display = 'block';
                    header.classList.add('visible-border');
                    categoryItem.classList.add('visible-border');                                
                    header.style.fontSize = '6rem';  // Set font size for expanded header
                    header.querySelector('.right').style.display = 'inline';  // Show second column
                    } else {                                
                    header.style.display = 'none';
                    categoryItem.style.display = 'none';
                    header.classList.remove('visible-border'); // Ensure these lines exist
                    categoryItem.classList.remove('visible-border');
                    header.querySelector('.right').style.display = 'none';  // Hide second column
                }
                
                // Now handle the last visible item in the category
                const visibleItems = Array.from(itemsInCategory).filter(item => item.style.display === 'block');
                if (visibleItems.length > 0) {    
                    const lastVisibleItem = visibleItems[visibleItems.length - 1];
                    lastVisibleItem.style.borderBottom = 'none'; // Remove border from the last visible item
                    lastVisibleItem.style.marginBottom = '2rem'; // Add this line
                }
                
                
                // Offers search code
                const offersContainer = document.getElementById('offers-container');
                offersContainer.innerHTML = ''; // Clear previous results
                
                const searchWords = normalizedSearchQuery.toLowerCase().split(/\s+/); // Split search query into words
                
                
                const matchedOffers = offersData.filter(offer => {
                    if (searchQuery.trim() === '') return true; // Include all offers when search is empty
                    const titleWords = offer[1].toLowerCase().split(/\s+/);
                    const descWords = offer[2].toLowerCase().split(/\s+/);
                    return searchWords.some(searchWord => 
                    titleWords.some(word => word.startsWith(searchWord)) || 
                    descWords.some(word => word.startsWith(searchWord))
                    );
                });
                
                if (matchedOffers.length > 0) {
                    offersContainer.innerHTML = matchedOffers.map(offer => {
                        const offerText = `🎊\n*${offer[1]}*\n(${formatDate(offer[0])} ${offer[3] ? `to ${formatDate(offer[3])}` : ''})\n${offer[2]}\n〰️〰️〰️〰️〰️〰️〰️〰️〰`;
                        
                        return `
                        <div class="offer-item" style="position: relative;">
                        
                        <button class="add-offer-btn" 
                        data-start="${offer[0]}" 
                        data-end="${offer[3] || ''}"
                        data-allow-once="${offer[4] || 'No'}" 
                        data-dependencies="${offer[5] || 'No'}">
                        +
                        </button>
                        <h2 class="offer-title">${offer[1]}</h2>
                        <p class="offer-dates">${formatDate(offer[0])} ${offer[3] ? `to ${formatDate(offer[3])}` : ''}</p>
                        <p class="offer-description">${offer[2]}</p>
                        </div>
                        `;
                    }).join('');
                    offersContainer.style.display = 'grid';
                    offersButton.querySelector('.arrow').textContent = '▲';
                    } else {
                    offersContainer.style.display = 'none';
                    offersButton.querySelector('.arrow').textContent = '▼'
                }
                
                // Update offers button counter dynamically
                const arrow = offersButton.querySelector('.arrow').outerHTML;
                offersButton.innerHTML = `${matchedOffers.length} Offer${matchedOffers.length !== 1 ? 's' : ''} ${arrow}`;
                
            });
            
            const totalItemsDiv = document.getElementById('total-items-found');
            
            if (searchQuery.length === 0) {
                totalItemsDiv.style.display = 'none'; // Hide when search box is empty
                updateOfferAddButtons();
                } else {
                if (totalVisibleItems > 0) {
                    // Check if totalVisibleItems is 1 (singular) or more (plural)
                    totalItemsDiv.textContent = `${totalVisibleItems} ${totalVisibleItems === 1 ? 'item' : 'items'}`;
                    totalItemsDiv.style.color = '#00FF00'; // Green for visibility
                    } else {
                    if (filterButtons.style.display === 'none') {
                        totalItemsDiv.textContent = 'No menu item found';
                        } else {
                        totalItemsDiv.textContent = 'No item';
                    }
                    
                    totalItemsDiv.style.color = '#ff4d4d'; // Red for visibility
                }
                totalItemsDiv.style.display = 'block'; // Show only when search is not empty
            }  
        }
        
        // Add event listener to filter buttons
        document.querySelectorAll('.filter-btn').forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                
                // Add active class to the clicked button
                button.classList.add('active');
                
                // Update the selected filter type
                selectedFilter = button.getAttribute('data-filter');
                
                // Trigger filtering
                const searchQuery = document.getElementById('searchInput').value.trim();
                filterMenuItems(searchQuery);
            });
        });
        
        
        // Function to reset headers and hide the second column when search is cleared
        function resetHeaders() {
            document.querySelectorAll('.category-header').forEach(header => {
                header.style.fontSize = '7rem';  // Reset to collapsed size
                header.querySelector('.right').style.display = 'none';  // Hide second column
                header.classList.remove('visible-border'); 
                
            });
            
            document.querySelectorAll('.category-items').forEach(container => {
                container.style.display = 'none';  // Collapse all categories
                container.classList.remove('visible-border'); 
                
            });
        }
        
        
        // Get references to the elements
        const searchInput = document.getElementById('searchInput');
        const clearButton = document.getElementById('clearButton');
        // The magnifierIcon remains always visible, so no toggling is required here
        
        // Modify the search handler like this
        searchInput.addEventListener('input', (e) => {
            let query = e.target.value;
            
            // Validate the input to allow only English or Gurmukhi characters
            const regex = /^[a-zA-Z0-9\u0A00-\u0A7F]*$/;
            if (!regex.test(query)) {
                e.target.value = query.slice(0, -1);
                return;
            }
            
            // 1. Convert replacements to array and sort by key length (longest first)
            const sortedReplacements = Object.entries(SEARCH_REPLACEMENTS)
            .sort((a, b) => b[0].length - a[0].length);
            
            // 2. Process replacements in sorted order
            sortedReplacements.forEach(([original, replacement]) => {
                const escapedOriginal = original.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                query = query.replace(
                new RegExp(escapedOriginal, 'g'),
                replacement
                );
            });
            
            // 3. Pass to filter
            filterMenuItems(query);
            
            // Existing clear button logic
            if (query.length > 0) {
                clearButton.style.display = 'block';
                } else {
                clearButton.style.display = 'none';
                setActiveTab("allButton");
                resetHeaders();
            }
            
            // NEW: Hide/show tab-container based on input
            const tabContainer = document.querySelector('.tab-container');
            if (query.length > 0) {
                tabContainer.style.display = 'none'; // Hide tab-container when typing
                } else {
                tabContainer.style.display = 'flex'; // Show tab-container when input is cleared
            }
            
            // NEW FIX (add these 4 lines at the very end):
            if (e.target.value === '' && offersContainer.style.display === 'grid') {
                offersContainer.style.display = 'none';
                offersButton.querySelector('.arrow').textContent = '▼';
            }
        });
        
        
        
        // Clear Button Event Listener
        clearButton.addEventListener('click', () => {
            searchInput.value = '';              // Clear input field
            clearButton.style.display = 'none';  // Hide the clear button
            
            // Reset filtering and collapse categories (your existing logic)
            filterMenuItems('');
            
            // Collapse all category items (your existing logic)
            document.querySelectorAll('.category-items').forEach(container => {
                container.style.display = 'none';
            });
            document.querySelectorAll('.category-header').forEach(header => {
                header.classList.remove('expanded');
            });
            
            // Focus back on the search box
            searchInput.focus();
            resetHeaders();
            setActiveTab("allButton");
            
            // Add this tab visibility control
            const tabContainer = document.querySelector('.tab-container');
            tabContainer.style.display = 'flex';
        });
        
        
        
        
        // Fetch data from Google Script URL
        fetch(scriptUrl)
        .then(response => response.json())
        .then(data => {
            
            
            // Expiry check
            if (data.error) {  
                alert(data.error); // Show error from backend
                return;
            }
            
            
            
            const menuDiv = document.getElementById('menu');
            let currentCategory = null;
            
            // Store all category item containers for collapsing
            const categoryItemsContainers = [];
            
            console.log("Fetched data:", data); // Debugging data fetching
            
            data.forEach(row => {
                const mergedColAB = row.columnB.trim() !== "" ? row.columnA + " (" + row.columnB + ")" : row.columnA;
                
                // Apply different colors to column C, D, and E and join them with " / "
                // Original code where you create colCDEElement:
                const mergedcolCDE = [
                row.columnC ? `<span style="color: #40E0D0;" data-column="C">${row.columnC}</span>` : '',
                row.columnD ? `<span style="color: #00FF7F;" data-column="D">${row.columnD}</span>` : '',
                //                            row.columnE ? `<span style="color: #E6E6FA;" data-column="E">${row.columnE}</span>` : ''
                row.columnE ? `<span style="color: #F8BBD0;" data-column="E">${row.columnE}</span>` : ''
                
                ].filter(col => col).join(' / ');
                
                const colCDEElement = document.createElement('span');
                colCDEElement.classList.add('colCDE');
                colCDEElement.innerHTML = mergedcolCDE;  // This now contains data-column attributes
                
                console.log("Merged colCDE:", mergedcolCDE); // Debugging merged colCDE
                
                // Check if columnC is empty or is a category header
                const isCategory = (String(row.columnC).trim() === "" || (isNaN(String(row.columnC)) && String(row.columnC).trim() !== "-"));
                
                console.log("Is category?", isCategory); // Debugging category check
                
                if (isCategory) {
                    const categoryHeaderDiv = document.createElement('div');
                    categoryHeaderDiv.classList.add('category-header');
                    
                    // MODIFIED: Store individual column values as data attributes
                    categoryHeaderDiv.dataset.columnC = row.columnC || '';
                    categoryHeaderDiv.dataset.columnD = row.columnD || '';
                    categoryHeaderDiv.dataset.columnE = row.columnE || '';
                    categoryHeaderDiv.dataset.columnF = row.columnF || '';
                    
                    
                    const leftPart = document.createElement('span');
                    leftPart.classList.add('left');
                    leftPart.textContent = mergedColAB;
                    
                    const rightPart = document.createElement('span');
                    rightPart.classList.add('right');
                    rightPart.innerHTML = mergedcolCDE;  // Use innerHTML to render the colored spans
                    
                    categoryHeaderDiv.appendChild(leftPart);
                    categoryHeaderDiv.appendChild(rightPart);
                    
                    const categoryItemsDiv = document.createElement('div');
                    categoryItemsDiv.classList.add('category-items');
                    
                    // Toggle category items visibility on click
                    categoryHeaderDiv.addEventListener('click', () => {
                        // Reset all other headers to default collapsed size and show only the first column
                        document.querySelectorAll('.category-header').forEach(header => {
                            header.style.fontSize = '7rem'; // Set collapsed size
                            header.querySelector('.right').style.display = 'none'; // Ensure second column is hidden
                            header.classList.remove('visible-border'); // Add this line
                        });
                        
                        document.querySelectorAll('.category-items').forEach(container => {
                            if (container !== categoryItemsDiv) {
                                container.style.display = 'none';
                                container.classList.remove('visible-border'); // Add this line
                            }
                        });
                        
                        // Toggle visibility and adjust styles accordingly
                        if (categoryItemsDiv.style.display === 'none' || categoryItemsDiv.style.display === '') {
                            categoryItemsDiv.style.display = 'block';
                            categoryHeaderDiv.style.fontSize = '6rem';
                            categoryHeaderDiv.querySelector('.right').style.display = 'inline'; // Show right column
                            categoryHeaderDiv.classList.add('visible-border');
                            categoryItemsDiv.classList.add('visible-border');
                            } else {
                            categoryItemsDiv.style.display = 'none';
                            categoryHeaderDiv.classList.remove('visible-border');
                            categoryItemsDiv.classList.remove('visible-border');
                        }
                    });
                    
                    // Initial state: Increase font size for collapsed categories and hide second column
                    categoryHeaderDiv.style.fontSize = '7rem';
                    categoryHeaderDiv.querySelector('.right').style.display = 'none';
                    
                    menuDiv.appendChild(categoryHeaderDiv);
                    menuDiv.appendChild(categoryItemsDiv);
                    
                    categoryItemsContainers.push(categoryItemsDiv);                    
                    currentCategory = categoryItemsDiv;
                    } else if (currentCategory) {
                    const menuItemDiv = document.createElement('div');
                    menuItemDiv.classList.add('menu-item');
                    menuItemDiv.style.marginBottom = '0';
                    
                    const lineDiv = document.createElement('div');
                    lineDiv.classList.add('menu-item-line');
                    
                    const colABElement = document.createElement('span');
                    colABElement.classList.add('colAB');
                    colABElement.textContent = mergedColAB;
                    
                    const colCDEElement = document.createElement('span');
                    colCDEElement.classList.add('colCDE');
                    colCDEElement.innerHTML = mergedcolCDE;  // Use innerHTML to render the colored spans
                    
                    lineDiv.appendChild(colABElement);
                    lineDiv.appendChild(colCDEElement);                        
                    menuItemDiv.appendChild(lineDiv);
                    currentCategory.appendChild(menuItemDiv);
                }
            });
            
            categoryItemsContainers.forEach(container => {
                container.style.display = 'none';
            });
            
            //Show elements
            // document.querySelector('.header').style.display = 'flex'; // Show header
            document.querySelector(".search-container").style.display = "block"; // Search container               
            document.querySelector(".tab-container").style.display = "flex"; // Tabs               
            document.querySelector('.footer-container').style.display = 'block'; // Show footer
            
            
            // Modify the loading overlay hide code to show the image overlay
            document.getElementById('loadingOverlay').style.display = 'none';
            
            
            
            // Set the image source when the overlay is shown
            document.getElementById('imageOverlay').addEventListener('click', () => {
                document.getElementById('driveImage').src = imageUrl;
            });
            
            
            
        })
        .catch(error => {
            console.error("Error fetching data:", error);
            document.getElementById('loadingOverlay').innerHTML = "<div class='loading-message'>Error loading menu</div>";
        });
        
        
        
        // Add this code where you initialize other JavaScript
        const fileId = "1_YZByTcu5rHIobQoOS1AZ_NjNCz98m8T";
        const timestamp = new Date().getTime();
        const imageUrl = `https://lh3.googleusercontent.com/d/${fileId}?t=${timestamp}`; 
        
        
        // Close image overlay
        document.getElementById('closeImage').addEventListener('click', () => {
            document.getElementById('imageOverlay').style.display = 'none';
        });
        
        // Optional: Close when clicking outside image
        document.getElementById('imageOverlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('imageOverlay')) {
                document.getElementById('imageOverlay').style.display = 'none';
            }
        });               
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        // Modify toggleScrapList function
        function toggleScrapList() {
            const overlay = document.querySelector('.scrap-overlay');
            const scrapList = document.getElementById('scrapList');
            const offerCartElement = document.getElementById('offer-cart');
            
            
            // Check if both carts are empty
            const hasScrapItems = scrapItems.length > 0;
            const hasCartItems = offerCart.length > 0;
            
            if (!hasScrapItems && !hasCartItems) {
                if (isWarningVisible) {
                    // Close warning if it's already visible
                    closeScrapList();
                    isWarningVisible = false;
                    } else {
                    // Show warning if not visible
                    showEmptyWarningInScrapList();
                    isWarningVisible = true;
                }
                return;
            }
            
            
            // Toggle visibility based on content
            scrapVisible = !scrapVisible;
            
            // Show/hide scrap list only if it has items
            scrapList.style.display = hasScrapItems && scrapVisible ? 'flex' : 'none';
            
            // Show/hide offer cart only if it has items
            offerCartElement.style.display = hasCartItems && scrapVisible ? 'block' : 'none';
            
            // Update positions if showing
            if (scrapVisible) {
                overlay.style.display = 'block';
                document.body.style.overflow = 'hidden';
                updateCartPosition();
                scrapListObserver.observe(scrapList);
                } else {
                overlay.style.display = 'none';
                document.body.style.overflow = '';
                scrapListObserver.unobserve(scrapList);
            }
            isWarningVisible = false;
        }
        
        // Add overlay click handler
        document.querySelector('.scrap-overlay').addEventListener('click', () => {
            closeScrapList();
            closeOfferCart();
        });
        
        
        
        // Empty-warning
        function showEmptyWarningInScrapList() {
            const scrapList = document.getElementById('scrapList');
            const scrapItemsContainer = document.getElementById('scrapItems');
            const totalPrice = document.getElementById('totalPrice');
            const buttonContainer = document.querySelector('.button-container');
            const h2 = scrapList.querySelector('h2');
            
            // Update heading
            h2.textContent = 'Begin shopping';
            h2.style.color = '#d32f2f';
            
            // Display scrap list overlay
            scrapList.style.display = 'flex';
            document.querySelector('.scrap-overlay').style.display = 'block';
            document.body.style.overflow = 'hidden';
            scrapVisible = true;
            
            // Insert empty warning message
            scrapItemsContainer.innerHTML = `
            <div class="empty-warning">
            <img src="icons/empty.svg" alt="Cart Icon" width="60" height="60">
            <p class="empty-text">
            Tap the <strong>Rate</strong> of items from 
            <a href="#" id="mainMenuLink" class="main-menu-link">Main Menu</a>
            </p>
            <p class="empty-text">OR</p>
            <div class="button-container-center">
            <button id="repeatLastOrder" class="smart-pick-btn">
            
            Repeat Last Order
            </button>
            </div>
            <p class="empty-text">OR </p>
            <p class="empty-text">use <strong>Magic</strong> button to add a random item</p>
            <div class="button-container-center">
            <button id="smartPickBtn" class="smart-pick-btn">
            <img src="icons/magic.svg" alt="Magic" class="button-icon">
            Magic Pick
            <img src="icons/magic.svg" alt="Magic" class="button-icon">
            </button>
            
            
            </p>
            </div>
            </div>
            `;
            
            // ✅ Add event listener to "Main Menu" link to run closeModal()
            document.getElementById("mainMenuLink").addEventListener("click", (event) => {
                event.preventDefault(); // Prevent default link behavior
                closeModal(); // Close modal when clicking "Main Menu"
            });
            
            
            // Hide irrelevant elements
            totalPrice.style.display = 'none';
            buttonContainer.style.display = 'none';
            isWarningVisible = true;
            
            // Add event listener with animation effect and delay
            document.getElementById('smartPickBtn').addEventListener('click', () => {
                triggerMagicAnimation(() => {
                    setTimeout(() => {
                        addRandomItem(); // Add item AFTER animation plays
                        // closeModal(); // Hide modal after adding item
                    }, 500); // Delay closing modal
                });
            });
            
            // Repeat Last Order functionality
            const repeatButton = document.getElementById('repeatLastOrder');
            
            repeatButton.addEventListener('click', () => {
                const lastOrder = localStorage.getItem('lastOrder');
                
                if (!lastOrder) {
                    repeatButton.disabled = true; // Fully disable the button
                    repeatButton.style.pointerEvents = 'none'; // Prevent clicks
                    repeatButton.style.opacity = '0.5'; // Make it visibly disabled
                    
                    // Show message below the button
                    let message = document.getElementById('orderMessage');
                    if (!message) {
                        message = document.createElement('p');
                        message.id = 'orderMessage';
                        message.textContent = "No previous order found";
                        message.style.color = 'red';
                        message.style.fontWeight = 'bold';
                        
                        message.style.marginTop = '8px';
                        message.style.fontSize = '14px';
                        repeatButton.parentNode.insertBefore(message, repeatButton.nextSibling);
                    }
                    
                    return;
                }
                
                triggerRepeatAnimation(() => {
                    setTimeout(() => {
                        try {
                            const parsedOrder = JSON.parse(lastOrder);
                            scrapItems = parsedOrder;
                            updateScrapListDisplay();
                            handleScrapItemsChange();
                            } catch (error) {
                            console.error('Error loading last order:', error);
                            showFeedback('Error loading last order');
                        }
                    }, 500); // Delay processing
                });
            });
            
        }
        
        
        
        // ✅ Function to trigger animation before processing
        function triggerRepeatAnimation(callback) {
            const button = document.getElementById('repeatLastOrder');
            
            // Remove and re-add the animation class to restart the animation
            button.classList.remove('repeat-animation');
            void button.offsetWidth; // Force reflow to apply animation again
            button.classList.add('repeat-animation');
            
            // Execute callback AFTER animation completes (800ms)
            setTimeout(() => {
                button.classList.remove('repeat-animation');
                if (callback) callback();
            }, 500);
        }
        
        
        // Function to trigger magic animation
        function triggerMagicAnimation(callback) {
            const btn = document.getElementById('smartPickBtn');
            
            // Add glow effect
            btn.classList.add('magic-glow');
            
            // Create sparkles
            for (let i = 0; i < 8; i++) {
                let sparkle = document.createElement('div');
                sparkle.classList.add('magic-sparkle');
                document.body.appendChild(sparkle);
                
                // Random position near the button
                let xOffset = Math.random() * 100 - 50;
                let yOffset = Math.random() * 50 - 25;
                let scale = Math.random() * 0.8 + 0.3;
                
                sparkle.style.left = `${btn.offsetLeft + btn.offsetWidth / 2 + xOffset}px`;
                sparkle.style.top = `${btn.offsetTop + yOffset}px`;
                sparkle.style.transform = `scale(${scale})`;
                
                // Remove after animation
                setTimeout(() => sparkle.remove(), 500);
            }
            
            // Remove glow effect after animation
            setTimeout(() => {
                btn.classList.remove('magic-glow');
                if (callback) callback(); // Call function after animation
            }, 500);
        }
        
        // Function to close modal after animation
        function closeModal() {
            document.getElementById('scrapList').style.display = 'none';
            document.querySelector('.scrap-overlay').style.display = 'none';
            document.body.style.overflow = 'auto';
            scrapVisible = false;
        }
        
        
        
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('smartPickBtn2').addEventListener('click', addRandomItem);
        });
        
        
        
        function showOrderListWarning() {                            
            let existingModal = document.getElementById('orderListWarningModal');
            if (existingModal) {
                existingModal.remove(); 
                isWarningVisible = false;
                return;
            }
            
            let modal = document.createElement('div');
            modal.id = 'orderListWarningModal';
            modal.className = 'modal-overlay';
            
            let contentEnglish = `
            <p><strong>Order list is empty.</strong></p>
            <ul>
            <li>Tap <b>rate</b> to add an item. In the order list, you can <b>increase, decrease or remove</b> items.</li>
            </ul>
            `;
            
            let contentPunjabi = `
            <p><strong>ਆਰਡਰ ਸੂਚੀ ਖਾਲੀ ਹੈ।</strong></p>
            <ul>
            <li>ਚੀਜ਼ਾਂ ਪਾਉਣ ਲਈ <b>ਰੇਟ</b> ਛੂਹੋ। ਆਰਡਰ ਸੂਚੀ ਵਿੱਚੋਂ, ਤੁਸੀਂ ਚੀਜ਼ਾਂ <b>ਘਟਾ, ਵਧਾ ਜਾਂ ਕੱਢ</b> ਸਕਦੇ ਹੋ</li>
            </ul>
            `;
            
            modal.innerHTML = `
            <div class="modal-content">
            <span class="close-button">&times;</span>
            <div id="modalText">${contentEnglish}</div>
            <div id="toggleContainer" class="toggle-container">
            <div id="toggleButton" class="split-toggle">
            <div id="englishSide" class="toggle-half active">Eng</div>
            <div id="punjabiSide" class="toggle-half">ਪੰਜਾਬੀ</div>
            </div>
            </div>
            </div>
            `;
            
            document.body.appendChild(modal);
            
            const toggleButton = document.getElementById('toggleButton');
            const modalText = document.getElementById('modalText');
            const englishSide = document.getElementById('englishSide');
            const punjabiSide = document.getElementById('punjabiSide');
            let isEnglish = true;
            
            toggleButton.addEventListener('click', () => {
                isEnglish = !isEnglish;
                if (isEnglish) {
                    modalText.innerHTML = contentEnglish;
                    englishSide.classList.add('active');
                    punjabiSide.classList.remove('active');
                    } else {
                    modalText.innerHTML = contentPunjabi;
                    punjabiSide.classList.add('active');
                    englishSide.classList.remove('active');
                }
            });
            
            function closeModal() {
                modal.remove();
                isWarningVisible = false;
                
                // Add this line to ensure scrap overlay is hidden
                document.querySelector('.scrap-overlay').style.display = 'none';
            }
            
            const autoCloseTimer = setTimeout(closeModal, 60000);
            
            modal.querySelector('.close-button').addEventListener('click', () => {
                clearTimeout(autoCloseTimer);
                closeModal();
            });
            
            modal.addEventListener('click', (event) => {
                if (event.target === modal) {
                    clearTimeout(autoCloseTimer);
                    closeModal();
                }
            });
            
            isWarningVisible = true;
        }
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        let scrapItems = [];
        let scrapVisible = false;                                                        
        // Add these JavaScript modifications
        
        // Add variable to track warning visibility
        let isWarningVisible = false;
        
        // Scrap Button Functionality
        document.getElementById('scrapButton').addEventListener('click', function(e) {
            // Prevent event from bubbling up to document listener
            e.stopPropagation();
            toggleScrapList();
        });
        
        function updateScrapButtonStatus() {
            const scrapButton = document.getElementById('scrapButton');
            const hasOfferItems = offerCart.length > 0;
            const scrapButtonImg = document.querySelector('#scrapButton img');
            
            // Check if either scrapItems or offerCart has items
            const hasItems = scrapItems.length > 0 || offerCart.length > 0;
            
            // scrapButton.classList.toggle('has-items', hasItems);
            scrapButton.classList.toggle('offer-has-items', hasOfferItems);
            //  scrapButton.classList.toggle('has-items', scrapItems.length > 0 || hasOfferItems);
            scrapButton.classList.toggle('has-items', scrapItems.length > 0);
            
            // Optional: Add subtle pulse animation when items are added
            if (hasItems) {
                scrapButton.style.animation = 'pulse-green 1s ease';
                setTimeout(() => scrapButton.style.animation = '', 1000);
            }
        }
        
        
        // Add this to your existing function
        function handleScrapItemsChange() {
            updateScrapListDisplay();
            updateScrapButtonStatus();
            updateScrapCounter();
            updateOfferAddButtons();
            
            
            // New: Remove dependent offers when scrap is empty
            if (scrapItems.length === 0) {
                const dependentOffersRemoved = offerCart.filter(group => group.dependent);
                offerCart = offerCart.filter(group => !group.dependent);
                
                if (dependentOffersRemoved.length > 0) {
                    showFeedback('Dependent offers removed');
                    updateCartDisplay();
                    updateOfferAddButtons();
                    updateScrapButtonStatus();
                }
            }
            updateCartDisplay();
            saveScrapItems();
        }
        
        
        // Add this function to update the counter
        function updateScrapCounter() {
            const counter = document.querySelector('#scrapButton .counter-badge');
            counter.textContent = scrapItems.length > 0 ? scrapItems.length : ''; 
            counter.style.display = scrapItems.length > 0 ? 'inline-block' : 'none';
            
            
            // Add animation when items are added
            if(scrapItems.length > 0) {
                counter.style.transform = 'scale(1.2)';
                setTimeout(() => counter.style.transform = 'scale(1)', 200);
            }
        } 
        
        
        
        
        
        // Add items to scrap list when clicking rates
        document.getElementById('menu').addEventListener('click', (e) => {
            
            const rateElement = e.target.closest('.colCDE span, .colCDE');
            if (rateElement && rateElement.textContent.match(/₹?\d+/)) {
                const menuItemLine = rateElement.closest('.menu-item-line');
                
                // Get which column was clicked (C/D/E)
                const column = rateElement.getAttribute('data-column');
                
                // Get category header
                const categoryHeader = menuItemLine.closest('.menu-item')
                .closest('.category-items')
                .previousElementSibling;
                
                // Get the specific column value from category header
                const columnValue = categoryHeader.dataset[`column${column}`]?.trim();
                
                // Build category name (without column value)
                const categoryName = categoryHeader.querySelector('.left').textContent.split('(')[0].trim();
                
                // Build item name
                let itemName = menuItemLine.querySelector('.colAB').textContent.split('(')[0].trim();
                
                // Add column value to item name if it exists
                if (columnValue) {
                    itemName += ` (${columnValue})`;
                }
                
                // Combine names
                const combinedName = `${categoryName} - ${itemName}`;
                
                // Rest of your existing click handling code...
                const clickedRate = rateElement.textContent.replace('₹', '').trim();
                
                if (clickedRate.includes('/')) {
                    showTapFeedbackInCenter('❌');
                    playBeep(600, 0.15);
                    } else {
                    animateRateMovement(rateElement);                                
                    scrapItems.push({ 
                        name: combinedName, 
                        rate: clickedRate 
                    });
                }
                
                
                updateScrapListDisplay();
            }
            handleScrapItemsChange();
        });
        
        // Rate add animation
        function animateRateMovement(sourceElement) {
            const scrapButton = document.getElementById('scrapButton');                        
            
            // Get positions of the source element and the scrap button
            const sourceRect = sourceElement.getBoundingClientRect();
            const targetRect = scrapButton.getBoundingClientRect();                        
            
            // Create a floating clone of the rate element
            const floatingClone = document.createElement('div');
            floatingClone.textContent = sourceElement.textContent;
            floatingClone.style.position = 'fixed';
            floatingClone.style.left = `${sourceRect.left}px`;
            floatingClone.style.top = `${sourceRect.top}px`;
            floatingClone.style.fontSize = '16px';
            floatingClone.style.fontWeight = 'bold';
            floatingClone.style.background = '#ffcc00';
            floatingClone.style.padding = '5px 10px';
            floatingClone.style.borderRadius = '5px';
            floatingClone.style.boxShadow = '0px 2px 5px rgba(0,0,0,0.2)';
            floatingClone.style.transition = 'transform 0.5s ease-out, opacity 0.5s ease-out';
            floatingClone.style.zIndex = '1000';
            
            document.body.appendChild(floatingClone);                        
            
            // Force repaint before moving
            requestAnimationFrame(() => {
                floatingClone.style.transform = `translate(${targetRect.left - sourceRect.left}px, ${targetRect.top - sourceRect.top}px) scale(0.5)`;
                floatingClone.style.opacity = '0';
            });                        
            
            // Remove the element after animation
            setTimeout(() => {
                floatingClone.remove();
            }, 500);
        }
        
        
        // Miss rate indication
        function showTapFeedbackInCenter(symbol) {
            const feedbackElement = document.createElement('div');
            feedbackElement.textContent = symbol;
            feedbackElement.style.position = 'fixed';
            
            // Center horizontally and vertically
            feedbackElement.style.left = `${window.innerWidth / 2}px`;
            feedbackElement.style.top = `${window.innerHeight / 2}px`;
            
            feedbackElement.style.transform = 'translate(-50%, -50%) scale(0)'; // Center and start small
            feedbackElement.style.fontSize = '6rem';
            feedbackElement.style.fontWeight = 'bold';
            feedbackElement.style.color = 'red';
            feedbackElement.style.transition = 'transform 0.3s ease-out, opacity 0.5s ease-out';
            feedbackElement.style.zIndex = '1000';
            
            document.body.appendChild(feedbackElement);
            
            // Trigger zoom-in effect
            requestAnimationFrame(() => {
                feedbackElement.style.transform = 'translate(-50%, -50%) scale(2)';
            });
            
            // Remove feedback after animation
            setTimeout(() => {
                feedbackElement.remove();
            }, 500);
        }
        
        // Miss tone
        let audioCtx; // Declare outside to initialize later
        let oscillator;
        
        document.addEventListener("click", () => {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                } else if (audioCtx.state === "suspended") {
                audioCtx.resume();
            }
        }, { once: true }); // Runs only once
        
        function playBeep(frequency, duration) {
            if (!audioCtx) {
                console.warn("AudioContext not initialized yet. User interaction required.");
                return;
            }
            
            if (audioCtx.state === "suspended") {
                audioCtx.resume().then(() => {
                    generateBeep(frequency, duration);
                });
                } else {
                generateBeep(frequency, duration);
            }
        }
        
        function generateBeep(frequency, duration) {
            if (oscillator) {
                oscillator.stop(); // Stop previous beep before starting a new one
            }
            
            oscillator = audioCtx.createOscillator();
            let gainNode = audioCtx.createGain();
            
            oscillator.type = "sine";
            oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.start();
            setTimeout(() => {
                oscillator.stop();
            }, duration * 1000);
        }
        
        
        
        
        
        
        
        
        
        function updateScrapListDisplay() {
            const scrapContainer = document.getElementById('scrapItems');
            // const totalPrice = document.getElementById('totalPrice');                       
            const buttonContainer = document.querySelector('.button-container');
            const scrapList = document.getElementById('scrapList');
            const h2 = scrapList.querySelector('h2');
            
            
            
            if (scrapItems.length > 0) {
                // Reset h2 text when items are present
                h2.textContent = 'Selected Items';
                // totalPrice.style.display = 'block';
                buttonContainer.style.display = 'flex';
                
            }
            
            // Step 1: Combine duplicate items and calculate quantities
            const itemMap = new Map();
            scrapItems.forEach((item) => {
                const key = `${item.name}-${item.rate}`;
                if (itemMap.has(key)) {
                    itemMap.get(key).qty++;
                    } else {
                    itemMap.set(key, { ...item, qty: 1 });
                }
            });
            
            // Step 2: Convert map values to array and sort alphabetically by item name
            // Step 2: Convert map values to array and sort alphabetically by item name
            const sortedItems = Array.from(itemMap.values()).sort((a, b) => {
                const nameA = a.name.replace(/[^a-zA-Z]/g, '').toLowerCase(); // Extract only English characters
                const nameB = b.name.replace(/[^a-zA-Z]/g, '').toLowerCase();
                return nameA.localeCompare(nameB);
            });
            
            
            // Step 3: Generate HTML for sorted items with quantity stepper
            scrapContainer.innerHTML = sortedItems.map((groupedItem) => `
            <div class="scrap-item">
            <div class="scrap-item-name"><strong>${groupedItem.name.replace(/\((.*?)\)/g, '<span class="column-value">($1)</span>')}</strong></div>
            <div class="scrap-item-rate">
            <div class="qty-stepper">
            <button class="decrement-btn" data-name="${groupedItem.name}" data-rate="${groupedItem.rate}">-</button>
            <span class="qty-display">${groupedItem.qty}</span>
            <button class="increment-btn" data-name="${groupedItem.name}" data-rate="${groupedItem.rate}">+</button>
            </div>
            <span> ₹${groupedItem.rate}</span>
            </div>
            <span class="delete-btn" data-name="${groupedItem.name}" data-rate="${groupedItem.rate}">✕</span>
            </div>
            `).join('');
            
            // Step 4: Calculate total quantity and total price
            const totalQuantity = sortedItems.reduce((acc, item) => acc + item.qty, 0); // Total quantity
            const totalPrice = sortedItems.reduce((acc, item) => acc + (parseFloat(item.rate) * item.qty), 0); // Total price
            
            // Step 5: Update the total price element to include total quantity
            const totalPriceElement = document.getElementById('totalPrice');
            totalPriceElement.textContent = `${totalQuantity} ${totalQuantity === 1 ? 'item' : 'items'} - Total: ₹${totalPrice.toFixed(0)}`;
            
            
            // Always reset these elements when updating display
            totalPriceElement.style.display = scrapItems.length > 0 ? 'block' : 'none';
            buttonContainer.style.display = scrapItems.length > 0 ? 'flex' : 'none';
            
            
            // Step 5: scrap-increment-button
            document.querySelectorAll('.increment-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const name = e.target.dataset.name;
                    const rate = e.target.dataset.rate;
                    const currentCount = scrapItems.filter(item =>
                    item.name === name && item.rate === rate
                    ).length;
                    
                    if (currentCount < 99) {
                        scrapItems.push({ name, rate });
                        updateScrapListDisplay();
                        updateScrapCounter();
                        updateIncrementButtonState(name, rate); // Update increment button state
                        updateDecrementButtonState(name, rate); // Ensure decrement button updates as well
                    }
                });
                
                // Initial button state setup (when the list first loads)
                updateIncrementButtonState(btn.dataset.name, btn.dataset.rate);
            });
            
            function updateIncrementButtonState(name, rate) {
                const currentCount = scrapItems.filter(item =>
                item.name === name && item.rate === rate
                ).length;
                
                const incrementButtons = document.querySelectorAll(`.increment-btn[data-name="${name}"][data-rate="${rate}"]`);
                
                incrementButtons.forEach(btn => {
                    btn.disabled = currentCount >= 99;
                });
                
                
            }
            
            // scrap-decrement-button                        
            document.querySelectorAll('.decrement-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const name = e.target.dataset.name;
                    const rate = e.target.dataset.rate;
                    const currentCount = scrapItems.filter(item =>
                    item.name === name && item.rate === rate
                    ).length;
                    
                    if (currentCount === 1) {
                        // Remove all instances if quantity is 1
                        scrapItems = scrapItems.filter(item =>
                        item.name !== name || item.rate !== rate
                        );
                        } else {
                        // Remove last instance of this item
                        let lastIndex = -1;
                        for (let i = scrapItems.length - 1; i >= 0; i--) {
                            if (scrapItems[i].name === name && scrapItems[i].rate === rate) {
                                lastIndex = i;
                                break;
                            }
                        }
                        if (lastIndex !== -1) scrapItems.splice(lastIndex, 1);
                    }
                    
                    updateScrapListDisplay();
                    updateScrapCounter();
                    updateDecrementButtonState(name, rate); // Update button state after changes
                });
                
                // Initial button state setup (when the list first loads)
                updateDecrementButtonState(btn.dataset.name, btn.dataset.rate);
            });
            
            function updateDecrementButtonState(name, rate) {
                const currentCount = scrapItems.filter(item =>
                item.name === name && item.rate === rate
                ).length;
                
                const decrementButtons = document.querySelectorAll(`.decrement-btn[data-name="${name}"][data-rate="${rate}"]`);
                
                decrementButtons.forEach(btn => {
                    btn.disabled = currentCount <= 1;
                });
            }
            
            
            // scrap-delete-button
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const name = e.target.dataset.name;
                    const rate = e.target.dataset.rate;
                    
                    // Remove the item from scrapItems
                    scrapItems = scrapItems.filter(item => item.name !== name || item.rate !== rate);
                    
                    // Check if scrapItems is empty
                    if (scrapItems.length === 0) {
                        
                        closeScrapList();
                        showFeedback("Order list cleared"); // Show feedback message
                    }
                    handleScrapItemsChange();
                    updateScrapListDisplay();
                });
            });
            updateCartPosition(); 
        }
        
        
        
        // Function to trim the first non-English character from a string
        function trimLeftNonEnglish(text) {
            return text.replace(/^[^A-Za-z]+/, '');
        }                    
        
        
        
        
        
        
        
        
        
        
        
        
        // Scrap-order button
        document.getElementById('orderScrap').addEventListener('click', async () => {
            if (scrapItems.length === 0) {
                showOrderListWarning();
                return;
            }                        
            
            const orderNumber = cachedOrderNumber + 1;
            
            // Group items by name and rate to calculate quantities
            const itemMap = new Map();
            scrapItems.forEach((item) => {
                const key = `${item.name}-${item.rate}`;
                itemMap.has(key) ? itemMap.get(key).qty++ : itemMap.set(key, { ...item, qty: 1 });
            });
            
            const sortedItems = Array.from(itemMap.values()).sort((a, b) => a.name.localeCompare(b.name));
            
            // Generate order text with quantities and total per row
            let orderText = sortedItems.map(item => {
                let itemTotal = item.qty * parseFloat(item.rate); // Calculate total for each row
                return item.qty > 1 
                ? `*${item.qty}* x ${trimLeftNonEnglish(item.name)} @ ₹${item.rate} - ₹${itemTotal}`
                : `*${item.qty}* x ${trimLeftNonEnglish(item.name)} - ₹${itemTotal}`;
            }).join('\n');                        
            
            // Calculate total cost
            let totalAmount = sortedItems.reduce((acc, item) => acc + (parseFloat(item.rate) * item.qty), 0);
            
            // Calculate total number of items
            let totalItems = sortedItems.reduce((acc, item) => acc + item.qty, 0);
            
            // List of food-related emojis
            let foodEmojis = ['🌶', '🫑', '🌽', '🍔', '🍟', '🍕', '🥙', '🌮', '🥗', '🍿', '🍎', '🍋', '🍓', '🍞', '🥘', '🍱', '🍧', '🍹', '👑', '☘️', '💥', '🍒', '🎁', '🎉', '🎊', '💝'];
            
            // Select a random emoji
            let randomEmoji = foodEmojis[Math.floor(Math.random() * foodEmojis.length)];
            
let message = `${randomEmoji}\n*Order No. ${orderNumber}*\n${'-'.repeat(30)}\n` +
`${sortedItems.map(item => {
    let itemTotal = item.qty * parseFloat(item.rate);
    return item.qty > 1 
    ? `*${item.qty}* x ${trimLeftNonEnglish(item.name)} @ ₹${item.rate} - ₹${itemTotal}`
    : `*${item.qty}* x ${trimLeftNonEnglish(item.name)} - ₹${itemTotal}`;
}).join('\n\n')}\n${'-'.repeat(30)}\n` +
`*${totalItems}* ${totalItems > 1 ? "items" : "item"} - *₹${Math.round(totalAmount)}* only\n${'-'.repeat(30)}`;



// Append offers message
if (offerCart.length > 0) {
    message += '\n\n🎊\n*Offers:*\n〰️〰️〰️〰️〰️〰️〰️\n';
    offerCart.forEach((group) => {
        group.dates.forEach(date => {
            message += `*${group.title}*\n${date}\n${group.description}\n〰️〰️〰️〰️〰️〰️〰️\n`;
        });
    });
}

// Encode the full message before using it
message = encodeURIComponent(message);

            
            
            window.open(`https://wa.me/${whatsappOfferNumber}?text=${message}`, '_blank');
            
            // Add this line to save to localStorage
            localStorage.setItem('lastOrder', JSON.stringify(scrapItems));
            
            
            // Clear the scrap list after ordering
            scrapItems = [];
            offerCart = [];
            localStorage.removeItem('scrapList'); // Add this line
            updateScrapListDisplay();
            handleScrapItemsChange();
            closeScrapList();
            showFeedback("Order sent. List cleared!"); // Optional feedback
            
            
            updateCounter('updateOrders');
            cachedOrderNumber = orderNumber;
        });
        
        
        // scrap-clear button
        document.getElementById('clearScrap').addEventListener('click', () => {
            scrapItems = [];
            offerCart = [];
            handleScrapItemsChange();
            updateCartDisplay();
            showFeedback("All items cleared!");
            closeScrapList();
        });  
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        // Add this in the script section
        function saveScrapItems() {
            localStorage.setItem('scrapList', JSON.stringify(scrapItems));
        }
        
        function loadScrapItems() {
            const saved = localStorage.getItem('scrapList');
            if (saved) {
                try {
                    scrapItems = JSON.parse(saved);
                    handleScrapItemsChange();
                    } catch (e) {
                    console.error('Error loading scrap items:', e);
                    localStorage.removeItem('scrapList');
                }
            }
        }
        
        
        
        // Add this in the DOMContentLoaded event listener
        document.addEventListener("DOMContentLoaded", function () {
            loadScrapItems();
            setActiveTab("allButton");
        }); 
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        let offersData = [];
        let offerNsg = '';
        let offerCart = [];
        // Add these variables at the top with other cart variables
        let offerCartVisible = false;
        
        // Offer Section
        function formatDate(dateString) {
            const date = new Date(dateString);
            const day = date.getDate().toString().padStart(2, '0');
            const month = date.toLocaleString('en-US', { month: 'short' });
            const year = date.getFullYear().toString().slice(-2);
            return `${day}-${month}-${year}`;
        }
        
        // Offer elements
        const offersButton = document.getElementById('offers-button');
        const offersContainer = document.getElementById('offers-container');
        
        fetch(scriptUrl + "?sheet=offer")
        .then(response => response.json())
        .then(offerData => {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Filter valid offers
            const validOffers = offerData.filter(offer => {
                const startDate = new Date(offer[0]);
                const endDate = new Date(offer[3]);
                
                // Normalize time to ensure date-only comparison
                startDate.setHours(0, 0, 0, 0);
                endDate.setHours(23, 59, 59, 999); // Include the full end day
                
                return today >= startDate && today <= endDate;
            });
            
            
            offersData = validOffers;
            
            if (validOffers.length > 0) {
                offersButton.innerHTML = `${validOffers.length} Offer${validOffers.length > 1 ? 's' : ''} <span class="arrow">▼</span>`;
                offersButton.style.display = 'block';
                
                offersButton.addEventListener('click', () => {
                    const isVisible = offersContainer.style.display === 'grid';
                    offersContainer.style.display = isVisible ? 'none' : 'grid';
                    offersButton.querySelector('.arrow').textContent = isVisible ? '▼' : '▲';
                    
                });
            }
            
            offersContainer.innerHTML = validOffers.map(offer => {
                return `
                <div class="offer-item" style="position: relative;">
                <button class="add-offer-btn" 
                data-start="${offer[0]}" 
                data-end="${offer[3] || ''}"
                data-allow-once="${offer[4] || 'No'}" 
                data-dependencies="${offer[5] || 'No'}">
                +
                </button>
                <h2 class="offer-title">${offer[1]}</h2>
                <p class="offer-dates">${formatDate(offer[0])} ${offer[3] ? `to ${formatDate(offer[3])}` : ''}</p>
                <p class="offer-description">${offer[2]}</p>
                </div>
                `;
            }).join('');
            updateOfferAddButtons(); // Initialize button states
        })
        .catch(error => {
            console.error('Error loading offers:', error);
        });
        
        
        
        function updateOfferAddButtons() {
            const addButtons = document.querySelectorAll('.add-offer-btn');
            addButtons.forEach(button => {
                const offerItem = button.closest('.offer-item');
                const offerTitle = offerItem.querySelector('.offer-title').textContent;
                const allowOnce = button.dataset.allowOnce === 'Yes';
                const dependencies = button.dataset.dependencies === 'Yes';
                
                // Check if offer exists in cart (regardless of quantity)
                const existsInCart = offerCart.some(item => item.title === offerTitle);
                
                button.disabled = (dependencies && scrapItems.length === 0) || 
                (allowOnce && existsInCart);
            });
        }
        
        // Modify the click handler to group by title
        document.getElementById('offers-container').addEventListener('click', function(e) {
            if (e.target.classList.contains('add-offer-btn')) {
                const button = e.target;
                const offerItem = button.closest('.offer-item');
                const offerTitle = offerItem.querySelector('.offer-title').textContent;
                const offerDescription = offerItem.querySelector('.offer-description').textContent;
                const dependencies = button.dataset.dependencies === 'Yes';
                const startDate = formatDate(button.dataset.start);
                const endDate = button.dataset.end ? formatDate(button.dataset.end) : null;
                const allowOnce = button.dataset.allowOnce === 'Yes';
                const dateString = endDate ? `${startDate} to ${endDate}` : startDate;
                
                // Check for existing offer group
                const existingGroup = offerCart.find(group => group.title === offerTitle);
                
                if (allowOnce && existingGroup) {
                    showFeedback('Offer already added!');
                    return;
                }
                
                if (existingGroup) {
                    // Add date if it's new
                    if (!existingGroup.dates.includes(dateString)) {
                        existingGroup.dates.push(dateString);
                    }
                    existingGroup.count++;
                    } else {
                    // Create new group
                    // When adding offers to the cart
                    offerCart.push({
                        title: offerTitle,
                        description: offerDescription,
                        dates: [dateString],
                        count: 1,
                        dependent: dependencies,
                        allowOnce: allowOnce // Add allowOnce flag
                    });
                }
                animateRateMovement(offerItem);
                showFeedback('Offer added!');
                updateOfferAddButtons();
                updateScrapButtonStatus();
                updateCartDisplay();
                
            }
        });                  
        
        
        
        // offer-button
        document.getElementById('toggle-cart').addEventListener('click', (e) => {
            e.stopPropagation();
            if (offerCart.length === 0) {
                showOrderListWarning();
                return;
            }
            toggleOfferCart();
        });
        
        // Modified toggle cart function
        function toggleOfferCart() {
            const offerCart = document.getElementById('offer-cart');
            
            if (offerCart.length === 0) {
                showOrderListWarning();
                offerCart.style.display = 'none';
                offerCartVisible = false;
                return;
            }
            
            offerCartVisible = !offerCartVisible;
            offerCart.style.display = offerCartVisible ? 'block' : 'none';
        }
        
        
        
        
        
        // Update cart display with stepper
        function updateCartDisplay() {
            const cartItems = document.getElementById('cart-items');
            const totalOffers = document.getElementById('totalOffers');
            const toggleBtn = document.getElementById('toggle-cart');
            
            
            if (offerCart.length === 0) {
                cartItems.innerHTML = '<div class="empty-cart">No offers selected</div>';
                totalOffers.textContent = 'Total Offers: 0';
                toggleBtn.textContent = 'Offer Cart (0)';
                closeOfferCart();
                return;
            }
            
            cartItems.innerHTML = offerCart.map((group, index) => `
            <div class="scrap-item">
            <div class="cart-item-header">
            <div class="cart-item-title">${group.title}</div>
            <!--   <div class="cart-item-date">${group.dates.join(', ')}</div> -->
            <div class="cart-item-description">${group.description}</div>
            </div>
            <div class="offer-stepper">
            <button class="off-decrement-btn" 
            onclick="adjustOfferQuantity(${index}, -1)"
            ${group.count <= 1 ? 'disabled' : ''}>-</button> <!-- Only check count -->
            <span class="offer-qty-display">${group.count}</span>
            <button class="off-increment-btn" 
            onclick="adjustOfferQuantity(${index}, 1)"
            ${(group.allowOnce && group.count >= 1) || 
            (group.dependent && scrapItems.length === 0) ? 'disabled' : ''}>+</button>
            </div>
            <span class="offer-delete-btn" data-title="${group.title}">✕</span>
            </div>
            `).join('');
            
            // offer-delete-button
            document.querySelectorAll('.offer-delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    offerCart.splice(index, 1);
                    updateCartDisplay();
                    updateScrapButtonStatus();
                    showFeedback('Offer removed');
                });
            });
            
            const totalItems = offerCart.reduce((sum, group) => sum + group.count, 0);
            totalOffers.textContent = `Total Offers: ${totalItems}`;
            toggleBtn.textContent = `Offer Cart (${totalItems})`;
            
            
        }
        
        
        
        
        // offer-stepper logic
        function adjustOfferQuantity(index, delta) {
            const group = offerCart[index];
            const maxLimit = group.allowOnce ? 1 : Infinity;
            
            // Validation checks
            if (delta === 1) {
                if (group.dependent && scrapItems.length === 0) {
                    showFeedback('Requires menu items!');
                    return;
                }
                if (group.count >= maxLimit) {
                    showFeedback('Can only add once!');
                    return;
                }
            }
            
            group.count += delta;
            
            if (group.count < 1) {
                offerCart.splice(index, 1);
            }
            
            updateCartDisplay();
            updateOfferAddButtons();
            updateScrapButtonStatus();
        }                 
        
        
        
        
        
        
        
        
        
        
        
        
        
        // offer-order button
        document.getElementById('order-offers').addEventListener('click', sendOfferCart);
        
        function sendOfferCart() {
            if (offerCart.length === 0) {
                showFeedback('Cart is empty!');
                return;
            }
            
            let message = '🎊\n';
            offerCart.forEach((group, index) => {
                group.dates.forEach(date => {
                    message += `*${group.title}*\n${date}\n${group.description}\n〰️〰️〰️〰️〰️〰️〰️〰️〰\n`;
                });
            });
            
            message += '\nPlease confirm these offers!';
            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/${whatsappOfferNumber}?text=${encodedMessage}`, '_blank');
            
            // Clear the cart after ordering
            offerCart = [];
            updateCartDisplay();
            showFeedback('Offers sent! Cart cleared');
            closeOfferCart();
            updateScrapButtonStatus();
        }
        
        // offer-clear button
        document.getElementById('clear-offers').addEventListener('click', clearOfferCart);
        
        function clearOfferCart() {
            offerCart = [];
            updateCartDisplay();
            updateOfferAddButtons();
            updateScrapButtonStatus();
            showFeedback('Offer cart cleared!');
            closeOfferCart();
        }
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        // Cloing of scraplist and offer-cart
        
        
        // scrap-close-outside offer-close-outside
        document.addEventListener('click', (e) => {
            const scrapList = document.getElementById('scrapList');
            const offerCart = document.getElementById('offer-cart');
            const scrapButton = document.getElementById('scrapButton');
            const toggleCart = document.getElementById('toggle-cart');
            
            // Close scrap list if click is outside
            if (scrapList.style.display === 'flex' && 
            !scrapList.contains(e.target) && 
            !scrapButton.contains(e.target)) {
                closeScrapList();
            }
            
            // Close offer cart if click is outside
            if (offerCart.style.display === 'block' && 
            !offerCart.contains(e.target) && 
            !toggleCart.contains(e.target)) {
                closeOfferCart();
            }
        });
        
        // offer-close-outside
        document.addEventListener('click', (e) => {
            if (!offersContainer.contains(e.target) && !offersButton.contains(e.target)) {
                offersContainer.style.display = 'none';
                const arrow = offersButton.querySelector('.arrow');
                if (arrow) arrow.textContent = '▼';
            }
        });
        
        
        // scrap-close-cross
        document.getElementById('closeScrap').addEventListener('click', function() {
            closeScrapList();
            closeOfferCart();
        });
        
        // Modify close functions
        function closeScrapList() {
            const scrapList = document.getElementById('scrapList');
            const offerCartElement = document.getElementById('offer-cart');
            const overlay = document.querySelector('.scrap-overlay');
            
            scrapList.style.display = 'none';
            scrapVisible = false;
            isWarningVisible = false;
            
            // Check if offer cart is visible or has items before hiding overlay
            if (offerCartElement.style.display === 'block') {
                overlay.style.display = 'block'; // Keep overlay if offer cart is visible
                document.body.style.overflow = 'hidden';
                } else {
                overlay.style.display = 'none'; // Hide overlay only when both are closed
                document.body.style.overflow = '';
            }
        }                     
        
        // offer-close-cross
        document.getElementById('closeOffer').addEventListener('click', closeOfferCart);                    
        
        function closeOfferCart() {
            const scrapList = document.getElementById('scrapList');
            const overlay = document.querySelector('.scrap-overlay');
            
            // Hide the offer cart
            document.getElementById('offer-cart').style.display = 'none';
            offerCartVisible = false;
            
            // Only hide the overlay if scrapList is also not visible
            if (scrapList.style.display !== 'flex') {
                overlay.style.display = 'none';
                document.body.style.overflow = '';
            }
        }
        
        
        // scrap-close-esc offer-close-esc
        document.addEventListener('keydown', (e) => {
            if (e.key === "Escape") {
                closeScrapList();
                closeOfferCart();
            }
        });
        
        
        // Add stopPropagation to the containers to prevent immediate closing
        document.getElementById('scrapList').addEventListener('click', e => e.stopPropagation());
        document.getElementById('offer-cart').addEventListener('click', e => e.stopPropagation());                
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        document.addEventListener("DOMContentLoaded", function () {
            const header = document.querySelector(".header");
            if (header) {
                const headerHeight = header.offsetHeight; // Get header height
                document.documentElement.style.setProperty("--header-bottom", `${headerHeight + 18}px`);
            }
        });
        
        
        
        
        
        
        
        
        // Add this function to update positions
        function updateCartPosition() {
            const scrapList = document.getElementById('scrapList');
            const offerCart = document.getElementById('offer-cart');
            
            // Ensure smooth transition effect
            offerCart.style.transition = 'top 0.5s ease-in-out, transform 0.5s ease-in-out';
            
            
            if (scrapList.style.display === 'flex' && scrapList.children.length > 0) {
                // Position offer-cart below scrapList but keep it centered
                const scrapListRect = scrapList.getBoundingClientRect();
                offerCart.style.position = 'fixed';
                offerCart.style.top = `${scrapListRect.bottom + 10}px`;
                offerCart.style.left = '50%'; // Center it horizontally
                offerCart.style.transform = 'translateX(-50%)'; // Adjust centering
                offerCart.style.width = `${scrapList.offsetWidth}px`; // Optional: Match width
                } else {
                // Reset to default centered position
                offerCart.style.position = 'fixed';
                offerCart.style.top = 'var(--header-bottom, 8%)'; // Default position when scrapList is empty
                offerCart.style.left = '50%'; // Keep it centered
                offerCart.style.transform = 'translateX(-50%)';
                offerCart.style.width = ''; // Reset width
            }
        }
        
        // Observer to track changes in scrapList
        const scrapListObserver = new ResizeObserver(() => {
            if (scrapVisible) {
                updateCartPosition();
            }
        });
        
        // Update position on window resize
        window.addEventListener('resize', updateCartPosition);
        window.addEventListener('scroll', updateCartPosition); // Keep it fixed on scroll  
        
        
        
        
        
        
        
        
        document.addEventListener("DOMContentLoaded", () => {
            const scrapList = document.getElementById('scrapList');
            const offerCart = document.getElementById('offer-cart');
            
            function adjustScrapListHeight() {
                const offerCartDisplay = window.getComputedStyle(offerCart).display;
                
                
                // Apply transition directly in JavaScript
                scrapList.style.transition = "max-height 0.5s ease-in-out";
                scrapList.style.transition = (offerCartDisplay === 'none') ? "max-height 0.5s ease-in-out" : "";
                
                scrapList.style.maxHeight = (offerCartDisplay === 'none') ? '55vh' : '45vh';        
            }
            
            const observer = new MutationObserver(() => adjustScrapListHeight());
            
            observer.observe(offerCart, {
                attributes: true,
                attributeFilter: ['style', 'class']
            });
            
            window.addEventListener('resize', adjustScrapListHeight);
            
            adjustScrapListHeight(); // Initial adjustment
        });
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js').then(reg => {
                setInterval(() => {
                    reg.update().then(() => {
                        if (reg.installing || reg.waiting) {
                            console.log("New update found!");
                            showUpdateNotification(reg);
                        }
                    });
                }, 5000); // Check every 5 seconds
            });
            
            
        }
        
        function showUpdateNotification(reg) {
            if (document.getElementById("update-notification")) {
                return; // Prevent multiple notifications
            }
            
            let updateDiv = document.createElement("div");
            updateDiv.id = "update-notification";
            updateDiv.innerHTML = `
            <button id="refresh-btn" 
            style="position: fixed;
            left: 50%; /* Center horizontally */
            top: 50%; /* Center vertically */
            transform: translate(-50%, -50%); /* Adjust for exact center */
            background: #4CAF50;
            color: white;
            padding: 2rem;
            border: none;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2), 0 6px 20px rgba(0,0,0,0.19);
            cursor: pointer;
            font-size: 4rem;
            transition: transform 0.1s, box-shadow 0.1s;
            z-index: 1001;">
            Refresh<br>Updates
            </button>`;
            document.body.appendChild(updateDiv);
            
            document.getElementById("refresh-btn").addEventListener("click", function () {
                console.log("Refresh button clicked!");
                
                // Check if a waiting service worker exists
                if (reg.waiting) {
                    reg.waiting.postMessage({ action: "skipWaiting" });
                    
                    reg.waiting.addEventListener("statechange", () => {
                        if (reg.waiting.state === "activated") {
                            console.log("New Service Worker activated, reloading...");
                            window.location.reload();
                        }
                    });
                    
                    // Fallback: Force reload after 3 seconds if no statechange fires
                    setTimeout(() => {
                        console.log("Forcing reload as a fallback...");
                        window.location.reload();
                    }, 3000);
                    } else {
                    console.log("No waiting service worker found. Reloading...");
                    window.location.reload(); // Force refresh if no service worker is waiting
                }
            });
        }
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </script>        
    <script src="app.js"></script> <!-- PWA -->                
    <script src="com.js"></script> <!-- Commu sidebar -->                
    <script src="ham.js"></script> <!-- Hamburger sidebar -->                
    <script src="counter.js"></script> <!-- Counters -->                
    <script src="cheat.js"></script> <!-- Cheats, Dev tools -->         
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
</body>
</html>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
